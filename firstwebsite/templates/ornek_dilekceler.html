{% extends "layout.html" %}

{% block title %}Örnek Dilekçeler{% endblock %}

{% block head %}
{{ super() }}
<style>
/* Örnek Dilekçeler Sayfası Özel Stilleri */
.ornek-dilekceler-container {
    /* Bu sayfaya özel stil ayarları buraya eklenebilir */
}

/* Sıralanabilir tablo stilleri */
.sortable:hover {
    background-color: #e9ecef !important;
}

.sortable .sort-icon {
    transition: transform 0.2s ease;
    color: #6c757d;
}

.sortable.asc .sort-icon {
    transform: rotate(180deg);
    color: #2d313c;
}

.sortable.desc .sort-icon {
    transform: rotate(0deg);
    color: #2d313c;
}

/* Toast stilleri sayfaya özel */
.ornek-dilekceler-container .toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1070;
}

/* TAM EKRAN MODAL - ZORLA UYGULANAN CSS - EN ÜST ÖNCELIK */
div.file-detail-modal,
#previewModal,
.file-detail-modal,
div[id="previewModal"],
div[class*="file-detail-modal"] {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    max-width: 100vw !important;
    max-height: 100vh !important;
    background: rgba(0, 0, 0, 0.9) !important;
    z-index: 999999 !important;
    display: none !important;
    justify-content: center !important;
    align-items: center !important;
    overflow: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    transform: none !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* Modal görünür olduğunda */
div.file-detail-modal[style*="flex"],
#previewModal[style*="flex"],
.file-detail-modal[style*="flex"],
div[id="previewModal"][style*="flex"],
div[class*="file-detail-modal"][style*="flex"] {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* Modal içerik */
div.preview-modal-content,
.preview-modal-content,
#previewModal .preview-modal-content {
    width: calc(100vw - 40px) !important;
    height: calc(100vh - 40px) !important;
    max-width: calc(100vw - 40px) !important;
    max-height: calc(100vh - 40px) !important;
    background: white !important;
    display: flex !important;
    flex-direction: column !important;
    position: relative !important;
    border-radius: 8px !important;
    margin: 20px !important;
    padding: 0 !important;
    overflow: hidden !important;
    border: none !important;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5) !important;
    left: auto !important;
    top: auto !important;
    right: auto !important;
    bottom: auto !important;
    transform: none !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* Modal header */
.preview-modal-content .modal-header {
    background: #f8f9fa !important;
    border-bottom: 1px solid #dee2e6 !important;
    padding: 15px 20px !important;
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    flex-shrink: 0 !important;
    height: 60px !important;
    margin: 0 !important;
    border-radius: 8px 8px 0 0 !important;
    position: relative !important;
    width: 100% !important;
    box-sizing: border-box !important;
}

/* Modal title */
.preview-modal-content .modal-header h2 {
    margin: 0 !important;
    font-size: 1.25rem !important;
    font-weight: 500 !important;
    color: #212529 !important;
    display: flex !important;
    align-items: center !important;
    flex: 1 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
}

/* Close button */
.preview-modal-content .close-btn {
    background: none !important;
    border: none !important;
    font-size: 1.5rem !important;
    color: #6c757d !important;
    cursor: pointer !important;
    padding: 8px !important;
    border-radius: 4px !important;
    transition: all 0.2s !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    margin: 0 !important;
    width: 40px !important;
    height: 40px !important;
    flex-shrink: 0 !important;
}

.preview-modal-content .close-btn:hover {
    background: rgba(0, 0, 0, 0.1) !important;
    color: #495057 !important;
}

/* Modal body */
.preview-modal-body {
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
    background: #fff !important;
    margin: 0 !important;
    padding: 0 !important;
    height: calc(100% - 60px) !important;
    position: relative !important;
    width: 100% !important;
    box-sizing: border-box !important;
}

/* Document container */
.document-preview-container {
    flex: 1 !important;
    overflow: auto !important;
    background: white !important;
    position: relative !important;
    width: 100% !important;
    height: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
}

/* Iframe ve img stilleri */
.document-preview-container iframe {
    width: 100% !important;
    height: 100% !important;
    border: none !important;
    margin: 0 !important;
    padding: 0 !important;
    background: white !important;
    display: block !important;
}

.document-preview-container img {
    max-width: 100% !important;
    max-height: 100% !important;
    object-fit: contain !important;
    margin: 0 auto !important;
    display: block !important;
    background: white !important;
}

/* Bootstrap modal override - tüm bootstrap modallarını etkisiz hale getir */
.modal.fade,
.modal.show,
.modal-backdrop {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
}

/* Bootstrap conflicts temizleme */
.modal-dialog,
.modal-content {
    position: static !important;
    transform: none !important;
    width: auto !important;
    max-width: none !important;
    height: auto !important;
    max-height: none !important;
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
}

/* Yükleme ve hata durumları */
.preview-loading, .preview-error {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 40px !important;
    text-align: center !important;
    height: 100% !important;
    background: white !important;
    color: #333 !important;
}

.preview-loading .spinner {
    border: 4px solid #f3f3f3 !important;
    border-top: 4px solid #007bff !important;
    border-radius: 50% !important;
    width: 50px !important;
    height: 50px !important;
    animation: spin 1s linear infinite !important;
    margin-bottom: 20px !important;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Material Icons düzeltmeleri */
.material-icons {
    font-family: 'Material Icons' !important;
    font-weight: normal !important;
    font-style: normal !important;
    font-size: 24px !important;
    line-height: 1 !important;
    letter-spacing: normal !important;
    text-transform: none !important;
    display: inline-block !important;
    white-space: nowrap !important;
    word-wrap: normal !important;
    direction: ltr !important;
    -webkit-font-smoothing: antialiased !important;
    vertical-align: middle !important;
}

/* Error button */
.preview-error .btn {
    background: #007bff !important;
    color: white !important;
    border: none !important;
    padding: 10px 20px !important;
    border-radius: 4px !important;
    cursor: pointer !important;
    font-size: 14px !important;
    text-decoration: none !important;
    display: inline-flex !important;
    align-items: center !important;
    gap: 8px !important;
    margin-top: 15px !important;
}

.preview-error .btn:hover {
    background: #0056b3 !important;
}

/* Z-index override - en üste çık */
div.file-detail-modal,
#previewModal,
.file-detail-modal {
    z-index: 2147483647 !important; /* Maximum z-index */
}

/* Body scroll engellemesi modal açıkken */
body.modal-open {
    overflow: hidden !important;
    padding-right: 0 !important;
}

/* Responsive ayarları */
@media (max-width: 768px) {
    div.preview-modal-content,
    .preview-modal-content {
        width: calc(100vw - 20px) !important;
        height: calc(100vh - 20px) !important;
        margin: 10px !important;
    }
    
    .preview-modal-content .modal-header {
        padding: 10px 15px !important;
        height: 50px !important;
    }
    
    .preview-modal-content .modal-header h2 {
        font-size: 1.1rem !important;
    }
    
    .preview-modal-body {
        height: calc(100% - 50px) !important;
    }
}

/* Tüm diğer modal library çakışmalarını önle */
[class*="modal"],
[id*="modal"],
.fade,
.show {
    z-index: auto !important;
}

div.file-detail-modal[style*="flex"],
#previewModal[style*="flex"] {
    z-index: 2147483647 !important;
}

/* Kategori Yönetimi Modern Grid ve Kart Stilleri - Geliştirilmiş */
.kategori-yonetimi-box {
    background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%) !important;
    border-radius: 16px !important;
    box-shadow: 0 8px 32px rgba(0,0,0,0.08) !important;
    padding: 28px 24px 24px 24px !important;
    margin-bottom: 32px !important;
    border: 1px solid #e5e7eb !important;
    backdrop-filter: blur(10px) !important;
}

.kategori-yonetimi-box h5 {
    font-size: 1.25rem !important;
    font-weight: 700 !important;
    color: #1e293b !important;
    margin-bottom: 20px !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
}

.kategori-yonetimi-box h5 i {
    color: #3b82f6 !important;
    font-size: 1.3rem !important;
}

.mevcut-kategoriler-box {
    min-height: 100px !important;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
    border-radius: 16px !important;
    padding: 20px 16px 16px 16px !important;
    border: 1px solid #e2e8f0 !important;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.04) !important;
}

.kategori-grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)) !important;
    gap: 16px !important;
    align-items: stretch !important;
}

.kategori-card-pro {
    position: relative !important;
    background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%) !important;
    border-radius: 12px !important;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08) !important;
    padding: 20px 16px 16px 16px !important;
    min-height: 100px !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important;
    justify-content: space-between !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    border: 1px solid #e5e7eb !important;
    cursor: pointer !important;
    overflow: hidden !important;
}

.kategori-card-pro::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #3b82f6, #6366f1);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.kategori-card-pro:hover {
    box-shadow: 0 12px 40px rgba(0,0,0,0.15) !important;
    transform: translateY(-4px) scale(1.02) !important;
    border-color: #3b82f6 !important;
}

.kategori-card-pro:hover::before {
    opacity: 1;
}

.kategori-sil-btn-pro {
    position: absolute !important;
    top: 8px !important;
    right: 8px !important;
    border: none !important;
    background: rgba(255, 255, 255, 0.9) !important;
    color: #94a3b8 !important;
    font-size: 0.9rem !important;
    padding: 6px !important;
    border-radius: 8px !important;
    transition: all 0.3s ease !important;
    z-index: 3 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 28px !important;
    height: 28px !important;
    backdrop-filter: blur(10px) !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
    opacity: 0 !important;
    visibility: hidden !important;
    transform: scale(0.8) !important;
}

.kategori-card-pro:hover .kategori-sil-btn-pro {
    opacity: 1 !important;
    visibility: visible !important;
    transform: scale(1) !important;
}

.kategori-sil-btn-pro:hover {
    background: rgba(239, 68, 68, 0.1) !important;
    color: #ef4444 !important;
    transform: scale(1.1) !important;
    box-shadow: 0 4px 16px rgba(239, 68, 68, 0.2) !important;
}

.kategori-folder-icon-pro {
    font-size: 1.8rem !important;
    color: #3b82f6 !important;
    margin-bottom: 8px !important;
    margin-right: 4px !important;
    transition: all 0.3s ease !important;
}

.kategori-card-pro:hover .kategori-folder-icon-pro {
    color: #1d4ed8 !important;
    transform: scale(1.1) !important;
}

.kategori-adi-pro {
    font-size: 1.05rem !important;
    font-weight: 600 !important;
    color: #1e293b !important;
    max-width: 100% !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    margin-bottom: 4px !important;
    margin-top: 4px !important;
    letter-spacing: 0.02em !important;
    transition: color 0.3s ease !important;
}

.kategori-card-pro:hover .kategori-adi-pro {
    color: #0f172a !important;
}

/* Kategori ekleme formu geliştirilmiş stili */
.kategori-yonetimi-box .input-group {
    box-shadow: 0 2px 12px rgba(0,0,0,0.04) !important;
    border-radius: 12px !important;
    overflow: hidden !important;
    border: 1px solid #e5e7eb !important;
}

.kategori-yonetimi-box .form-control {
    border: none !important;
    padding: 14px 16px !important;
    font-size: 1rem !important;
    background: #ffffff !important;
    color: #1e293b !important;
    font-weight: 500 !important;
}

.kategori-yonetimi-box .form-control:focus {
    box-shadow: none !important;
    border-color: transparent !important;
    background: #ffffff !important;
}

.kategori-yonetimi-box .btn-dark {
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
    border: none !important;
    padding: 14px 24px !important;
    font-weight: 600 !important;
    letter-spacing: 0.02em !important;
    transition: all 0.3s ease !important;
}

.kategori-yonetimi-box .btn-dark:hover {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2) !important;
}

/* Boş kategori mesajı */
.mevcut-kategoriler-box .text-muted {
    font-size: 1rem !important;
    color: #64748b !important;
    font-weight: 500 !important;
    padding: 24px !important;
    text-align: center !important;
    background: rgba(255, 255, 255, 0.5) !important;
    border-radius: 12px !important;
    border: 2px dashed #cbd5e1 !important;
}

/* Responsive düzeltmeleri */
@media (max-width: 768px) {
    .kategori-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)) !important;
        gap: 12px !important;
    }
    
    .kategori-card-pro {
        min-height: 85px !important;
        padding: 16px 12px 12px 12px !important;
    }
    
    .kategori-yonetimi-box {
        padding: 20px 16px 16px 16px !important;
    }
}

/* Kategori Yönetimi Modern Grid ve Kart Stilleri - Geliştirilmiş */
.kategori-yonetimi-box {
    background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%) !important;
    border-radius: 16px !important;
    box-shadow: 0 8px 32px rgba(0,0,0,0.08) !important;
    padding: 28px 24px 24px 24px !important;
    margin-bottom: 32px !important;
    border: 1px solid #e5e7eb !important;
    backdrop-filter: blur(10px) !important;
}

.kategori-yonetimi-box h5 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.kategori-yonetimi-box h5 i {
    color: #3b82f6;
    font-size: 1.3rem;
}

.mevcut-kategoriler-box {
    min-height: 100px !important;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
    border-radius: 16px !important;
    padding: 20px 16px 16px 16px !important;
    border: 1px solid #e2e8f0 !important;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.04) !important;
}

.kategori-grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)) !important;
    gap: 16px !important;
    align-items: stretch !important;
}

.kategori-card-pro {
    position: relative !important;
    background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%) !important;
    border-radius: 12px !important;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08) !important;
    padding: 20px 16px 16px 16px !important;
    min-height: 100px !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important;
    justify-content: space-between !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    border: 1px solid #e5e7eb !important;
    cursor: pointer !important;
    overflow: hidden !important;
}

.kategori-card-pro::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #3b82f6, #6366f1);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.kategori-card-pro:hover {
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    transform: translateY(-4px) scale(1.02);
    border-color: #3b82f6;
}

.kategori-card-pro:hover::before {
    opacity: 1;
}

.kategori-sil-btn-pro {
    position: absolute;
    top: 8px;
    right: 8px;
    border: none;
    background: rgba(255, 255, 255, 0.9);
    color: #94a3b8;
    font-size: 0.9rem;
    padding: 6px;
    border-radius: 8px;
    transition: all 0.3s ease;
    z-index: 3;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    opacity: 0;
    visibility: hidden;
    transform: scale(0.8);
}

.kategori-card-pro:hover .kategori-sil-btn-pro {
    opacity: 1;
    visibility: visible;
    transform: scale(1);
}

.kategori-sil-btn-pro:hover {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    transform: scale(1.1);
    box-shadow: 0 4px 16px rgba(239, 68, 68, 0.2);
}

.kategori-folder-icon-pro {
    font-size: 1.8rem;
    color: #3b82f6;
    margin-bottom: 8px;
    margin-right: 4px;
    transition: all 0.3s ease;
}

.kategori-card-pro:hover .kategori-folder-icon-pro {
    color: #1d4ed8;
    transform: scale(1.1);
}

.kategori-adi-pro {
    font-size: 1.05rem;
    font-weight: 600;
    color: #1e293b;
    max-width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 4px;
    margin-top: 4px;
    letter-spacing: 0.02em;
    transition: color 0.3s ease;
}

.kategori-card-pro:hover .kategori-adi-pro {
    color: #0f172a;
}

/* Kategori ekleme formu geliştirilmiş stili */
.kategori-yonetimi-box .input-group {
    box-shadow: 0 2px 12px rgba(0,0,0,0.04) !important;
    border-radius: 12px !important;
    overflow: hidden !important;
    border: 1px solid #e5e7eb !important;
}

.kategori-yonetimi-box .form-control {
    border: none !important;
    padding: 14px 16px !important;
    font-size: 1rem !important;
    background: #ffffff !important;
    color: #1e293b !important;
    font-weight: 500 !important;
}

.kategori-yonetimi-box .form-control:focus {
    box-shadow: none !important;
    border-color: transparent !important;
    background: #ffffff !important;
}

.kategori-yonetimi-box .btn-dark {
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
    border: none !important;
    padding: 14px 24px !important;
    font-weight: 600 !important;
    letter-spacing: 0.02em !important;
    transition: all 0.3s ease !important;
}

.kategori-yonetimi-box .btn-dark:hover {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2) !important;
}

/* Boş kategori mesajı */
.mevcut-kategoriler-box .text-muted {
    font-size: 1rem;
    color: #64748b;
    font-weight: 500;
    padding: 24px;
    text-align: center;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 12px;
    border: 2px dashed #cbd5e1;
}

/* Responsive düzeltmeleri */
@media (max-width: 768px) {
    .kategori-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)) !important;
        gap: 12px !important;
    }
    
    .kategori-card-pro {
        min-height: 85px !important;
        padding: 16px 12px 12px 12px !important;
    }
    
    .kategori-yonetimi-box {
        padding: 20px 16px 16px 16px !important;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4 ornek-dilekceler-container">
    <div class="row mb-4">
        <div class="col-12">
            <div class="bg-light p-4 rounded shadow-sm">
                <h1 class="display-5 mb-2"><i class="material-icons align-middle me-2" style="font-size: 36px;">description</i>Örnek Dilekçeler</h1>
                <p class="text-muted lead">Bu sayfada örnek dilekçeleri yönetebilirsiniz. Kategori ekleyebilir, dilekçe yükleyebilir, mevcut dilekçeleri listeleyebilir, düzenleyebilir, indirebilir, önizleyebilir ve silebilirsiniz.</p>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Kategori Yönetimi kutusu -->
        <div class="col-md-6">
            <div class="kategori-yonetimi-box" style="background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%) !important; border-radius: 16px !important; box-shadow: 0 8px 32px rgba(0,0,0,0.08) !important; padding: 28px 24px 24px 24px !important; margin-bottom: 32px !important; border: 1px solid #e5e7eb !important; backdrop-filter: blur(10px) !important;">
                <h5 class="mb-3" style="font-size: 1.25rem !important; font-weight: 700 !important; color: #1e293b !important; margin-bottom: 20px !important; display: flex !important; align-items: center !important; gap: 8px !important;"><i class="fas fa-sitemap" style="color: #2d313c !important; font-size: 1.3rem !important;"></i> Kategori Yönetimi</h5>
                <div class="input-group mb-3" style="box-shadow: 0 2px 12px rgba(0,0,0,0.04) !important; border-radius: 12px !important; overflow: hidden !important; border: 1px solid #e5e7eb !important;">
                    <input type="text" class="form-control" placeholder="Yeni Kategori Adı" id="yeniKategoriAdi" style="border: none !important; padding: 14px 16px !important; font-size: 1rem !important; background: #ffffff !important; color: #1e293b !important; font-weight: 500 !important;">
                    <button class="btn btn-dark" id="kategoriEkleBtn" style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important; border: none !important; padding: 14px 24px !important; font-weight: 600 !important; letter-spacing: 0.02em !important; transition: all 0.3s ease !important;">+ Ekle</button>
                </div>
                <div class="mevcut-kategoriler-box" style="min-height: 100px !important; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important; border-radius: 16px !important; padding: 20px 16px 16px 16px !important; border: 1px solid #e2e8f0 !important; box-shadow: inset 0 1px 3px rgba(0,0,0,0.04) !important;">
                    <!-- Sadece grid buraya JS ile eklenecek -->
                </div>
            </div>
        </div>

        <!-- Dilekçe Yükleme -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-light">
                    <h2 class="h5 mb-0 text-success"><i class="material-icons align-middle me-2">upload_file</i>Dilekçe Yükle</h2>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="dilekceDosyasi" class="form-label fw-bold">Dilekçe Dosyası Seçin</label>
                            <input class="form-control form-control-lg" type="file" id="dilekceDosyasi" style="min-width: 300px;">
                        <div class="form-text text-muted">Kabul edilen formatlar: DOC, DOCX, PDF, TXT</div>
                    </div>
                    <div class="mb-3">
                        <label for="dilekceKategorisi" class="form-label fw-bold">Kategori Seçin</label>
                        <select id="dilekceKategorisi" class="form-select form-select-lg" style="min-width: 300px; width: 100%;">
                            <!-- Kategoriler buraya dinamik olarak eklenecek -->
                            <option selected value="">Kategori Seçiniz...</option>
                        </select>
                    </div>
                    <div class="d-grid">
                        <button class="btn btn-outline-success btn-lg" onclick="dilekceYukle()">
                            <i class="material-icons align-middle me-2">cloud_upload</i>Yükle
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dilekçe Listesi -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm" style="border: none !important;">
                <div class="card-header bg-light" style="border-bottom: none !important;">
                    <h2 class="h5 mb-0" style="color: #2d313c;"><i class="material-icons align-middle me-2">list</i>Dilekçeler</h2>
                </div>
                <div class="card-body" style="border-top: none !important;">
                    <div class="mb-3">
                        <label for="listelenecekKategori" class="form-label fw-bold">Listelenecek Kategoriyi Seçin:</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light">
                                <i class="material-icons">filter_list</i>
                            </span>
                            <select id="listelenecekKategori" class="form-select form-select-lg" onchange="dilekceleriListele(this.value)" style="min-width: 300px; width: 100%;">
                                <option selected value="">Tüm Kategoriler</option>
                                <!-- Kategoriler buraya dinamik olarak eklenecek -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover table-striped align-middle" id="dilekceTablosu">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col" class="fw-bold sortable" onclick="sortTable(0)" style="cursor: pointer; user-select: none;">
                                        Dilekçe Adı <i class="material-icons sort-icon" style="font-size: 16px; vertical-align: middle;">unfold_more</i>
                                    </th>
                                    <th scope="col" class="fw-bold sortable" onclick="sortTable(1)" style="cursor: pointer; user-select: none;">
                                        Kategori <i class="material-icons sort-icon" style="font-size: 16px; vertical-align: middle;">unfold_more</i>
                                    </th>
                                    <th scope="col" class="fw-bold sortable" onclick="sortTable(2)" style="cursor: pointer; user-select: none;">
                                        Yüklenme Tarihi <i class="material-icons sort-icon" style="font-size: 16px; vertical-align: middle;">unfold_more</i>
                                    </th>
                                    <th scope="col" class="fw-bold text-center">İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="dilekceTablosuBody">
                                <!-- Dilekçeler buraya dinamik olarak eklenecek -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modallar (Örnek) -->

<!-- Silme Onay Modalı -->
<div class="modal fade" id="silOnayModal" tabindex="-1" aria-labelledby="silOnayModalLabel" aria-hidden="true" style="z-index: 1080;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-light">
        <h5 class="modal-title text-danger" id="silOnayModalLabel"><i class="material-icons align-middle me-2">warning</i>Silme Onayı</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Bu öğeyi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.
        <input type="hidden" id="silinecekOgeId">
        <input type="hidden" id="silinecekOgeTuru">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
        <button type="button" class="btn btn-outline-danger" onclick="onaylaSil()">
            <i class="material-icons align-middle me-1">delete</i>Sil
        </button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    // const csrfToken = "{{ csrf_token() }}"; // Bu satırı kaldırıyoruz, global CSRF_TOKEN kullanılacak.

    // Global değişkenler
    let dosyaOnizlemeModal;

    // CSRF_TOKEN değişkeni yoksa, meta tag'dan al
    if (typeof CSRF_TOKEN === 'undefined') {
        const meta = document.querySelector('meta[name="csrf-token"]');
        if (meta) {
            window.CSRF_TOKEN = meta.getAttribute('content');
        } else {
            // Eğer meta tag yoksa, CSRF token kullanmadan dene
            window.CSRF_TOKEN = null;
        }
    }

    // Kategori Fonksiyonları
    async function kategoriEkle() {
        const yeniKategoriAdi = document.getElementById('yeniKategoriAdi').value;
        if (!yeniKategoriAdi.trim()) {
            alert('Kategori adı boş olamaz.');
            return;
        }
        
        try {
            const headers = {
                'Content-Type': 'application/json'
            };
            
            // CSRF token varsa ekle
            if (CSRF_TOKEN) {
                headers['X-CSRFToken'] = CSRF_TOKEN;
            }
            
            const response = await fetch('/api/dilekce_kategorileri', {
                method: 'POST',
                headers: headers,
                body: JSON.stringify({ ad: yeniKategoriAdi.trim() })
            });
            const result = await response.json();
            if (result.success) {
                document.getElementById('yeniKategoriAdi').value = '';
                // Başarı bildirimi göster
                showToast('Başarılı', 'Kategori başarıyla eklendi.', 'success');
                kategorileriListele();
            } else {
                // Hata bildirimi göster
                showToast('Hata', 'Kategori eklenirken hata: ' + result.message, 'error');
            }
        } catch (error) {
            console.error('Kategori ekleme hatası:', error);
            // Hata bildirimi göster
            showToast('Hata', 'Kategori eklenirken bir ağ hatası oluştu.', 'error');
        }
    }

    async function kategorileriListele() {
        console.log('Kategoriler listeleniyor...');
        try {
            const response = await fetch('/api/dilekce_kategorileri');
            const result = await response.json();

            if (!result.success) {
                showToast('Hata', 'Kategoriler getirilirken hata: ' + result.message, 'error');
                return;
            }
            const kategoriler = result.kategoriler || [];

            // Mevcut Kategoriler kutusunu güncelle
            const mevcutKategorilerBox = document.querySelector('.mevcut-kategoriler-box');
            if (mevcutKategorilerBox) {
                mevcutKategorilerBox.innerHTML = '';
                if (kategoriler.length === 0) {
                    mevcutKategorilerBox.innerHTML = '<div class="text-muted text-center w-100">Hiç kategori yok.</div>';
                } else {
                    // Grid container
                    const grid = document.createElement('div');
                    grid.className = 'kategori-grid';
                    grid.style.cssText = 'display: grid !important; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)) !important; gap: 10px !important; align-items: stretch !important;';
                    
                    kategoriler.forEach(kat => {
                        const card = document.createElement('div');
                        card.className = 'kategori-card-pro';
                        card.style.cssText = 'position: relative !important; background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%) !important; border-radius: 10px !important; box-shadow: 0 2px 12px rgba(0,0,0,0.06) !important; padding: 12px 8px 8px 8px !important; min-height: 65px !important; display: flex !important; flex-direction: column !important; align-items: flex-start !important; justify-content: space-between !important; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important; border: 1px solid #e5e7eb !important; cursor: pointer !important; overflow: visible !important;';
                        
                        // Folder icon oluştur
                        const folderIcon = document.createElement('div');
                        folderIcon.className = 'kategori-folder-icon-pro';
                        folderIcon.style.cssText = 'font-size: 1.2rem !important; color: #2d313c !important; margin-bottom: 4px !important; margin-right: 4px !important; transition: all 0.3s ease !important;';
                        folderIcon.innerHTML = '<i class="fas fa-folder"></i>';
                        
                        // Kategori adı oluştur
                        const kategoriAdi = document.createElement('div');
                        kategoriAdi.className = 'kategori-adi-pro';
                        kategoriAdi.title = kat.ad;
                        kategoriAdi.style.cssText = 'font-size: 0.85rem !important; font-weight: 600 !important; color: #1e293b !important; max-width: 100% !important; white-space: nowrap !important; overflow: hidden !important; text-overflow: ellipsis !important; margin-bottom: 2px !important; margin-top: 2px !important; letter-spacing: 0.02em !important; transition: color 0.3s ease !important;';
                        kategoriAdi.textContent = kat.ad;
                        
                        // Buton container oluştur
                        const buttonsContainer = document.createElement('div');
                        buttonsContainer.className = 'kategori-buttons';
                        buttonsContainer.style.cssText = 'position: absolute !important; top: 6px !important; right: 6px !important; display: flex !important; gap: 4px !important; opacity: 0 !important; visibility: hidden !important; transform: scale(0.8) !important; transition: all 0.3s ease !important; z-index: 999 !important;';
                        
                        // Düzenle butonu
                        const duzenleBtn = document.createElement('button');
                        duzenleBtn.className = 'kategori-duzenle-btn-pro';
                        duzenleBtn.title = 'Kategoriyi Düzenle';
                        duzenleBtn.style.cssText = 'background: rgba(59, 130, 246, 0.9) !important; color: white !important; border: none !important; width: 22px !important; height: 22px !important; border-radius: 4px !important; font-size: 10px !important; display: flex !important; align-items: center !important; justify-content: center !important; cursor: pointer !important; backdrop-filter: blur(10px) !important; box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important; transition: all 0.2s ease !important;';
                        duzenleBtn.innerHTML = '<i class="fas fa-edit"></i>';
                        
                        // Sil butonu
                        const silBtn = document.createElement('button');
                        silBtn.className = 'kategori-sil-btn-pro';
                        silBtn.title = 'Kategoriyi Sil';
                        silBtn.style.cssText = 'background: rgba(239, 68, 68, 0.9) !important; color: white !important; border: none !important; width: 22px !important; height: 22px !important; border-radius: 4px !important; font-size: 10px !important; display: flex !important; align-items: center !important; justify-content: center !important; cursor: pointer !important; backdrop-filter: blur(10px) !important; box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important; transition: all 0.2s ease !important;';
                        silBtn.innerHTML = '<i class="fas fa-trash"></i>';
                        
                        // Butonları container'a ekle
                        buttonsContainer.appendChild(duzenleBtn);
                        buttonsContainer.appendChild(silBtn);
                        
                        // Elementleri card'a ekle
                        card.appendChild(buttonsContainer);
                        card.appendChild(folderIcon);
                        card.appendChild(kategoriAdi);
                        
                        // Hover effects
                        card.addEventListener('mouseenter', function() {
                            console.log('🎯 Kategori kartına mouse geldi:', kat.ad);
                            this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.12) !important';
                            this.style.transform = 'translateY(-2px) scale(1.01) !important';
                            this.style.borderColor = '#3b82f6 !important';
                            
                            // Direkt buttonsContainer referansını kullan
                            buttonsContainer.style.setProperty('opacity', '1', 'important');
                            buttonsContainer.style.setProperty('visibility', 'visible', 'important');
                            buttonsContainer.style.setProperty('transform', 'scale(1)', 'important');
                            console.log('👀 Butonlar görünür yapıldı');
                        });
                        
                        card.addEventListener('mouseleave', function() {
                            console.log('🚪 Kategori kartından mouse ayrıldı:', kat.ad);
                            this.style.boxShadow = '0 2px 12px rgba(0,0,0,0.06) !important';
                            this.style.transform = 'translateY(0) scale(1) !important';
                            this.style.borderColor = '#e5e7eb !important';
                            
                            // Direkt buttonsContainer referansını kullan
                            buttonsContainer.style.setProperty('opacity', '0', 'important');
                            buttonsContainer.style.setProperty('visibility', 'hidden', 'important');
                            buttonsContainer.style.setProperty('transform', 'scale(0.8)', 'important');
                            console.log('🙈 Butonlar gizlendi');
                        });
                        
                        // Kategori kartına tıklandığında o kategoriye göre arama yap
                        card.addEventListener('click', function(e) {
                            // Eğer butonlara tıklanmışsa card click'i çalıştırma
                            if (e.target.closest('.kategori-buttons')) {
                                return;
                            }
                            
                            // Kategori seçimini yap
                            const listelenecekKategoriSelect = document.getElementById('listelenecekKategori');
                            if (listelenecekKategoriSelect) {
                                listelenecekKategoriSelect.value = kat.id;
                                // Arama fonksiyonunu çağır
                                dilekceleriListele(kat.id);
                            }
                        });
                        
                        // Buton event'leri
                        silBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            kategoriSil(kat.id, kat.ad);
                        });
                        
                        duzenleBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            kategoriDuzenle(kat.id, kat.ad);
                        });
                        grid.appendChild(card);
                    });
                    mevcutKategorilerBox.appendChild(grid);
                }
            }

            // Select'leri güncelle
            const dilekceKategorisiSelect = document.getElementById('dilekceKategorisi');
            const listelenecekKategoriSelect = document.getElementById('listelenecekKategori');
            if (dilekceKategorisiSelect) {
                dilekceKategorisiSelect.innerHTML = '<option selected value="">Kategori Seçiniz...</option>';
                kategoriler.forEach(kat => {
                    const option = document.createElement('option');
                    option.value = kat.id;
                    option.textContent = kat.ad;
                    dilekceKategorisiSelect.appendChild(option);
                });
            }
            if (listelenecekKategoriSelect) {
                listelenecekKategoriSelect.innerHTML = '<option selected value="">Tüm Kategoriler</option>';
                kategoriler.forEach(kat => {
                    const option = document.createElement('option');
                    option.value = kat.id;
                    option.textContent = kat.ad;
                    listelenecekKategoriSelect.appendChild(option.cloneNode(true));
                });
            }
            console.log('Kategoriler yüklendi.');
        } catch (error) {
            console.error('Kategorileri listeleme hatası:', error);
            showToast('Hata', 'Kategoriler getirilirken bir ağ hatası oluştu.', 'error');
        }
    }

    async function kategoriSil(kategoriId, kategoriAdi) {
        if (!confirm(`"${kategoriAdi}" kategorisini silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.`)) {
            return;
        }
        
        try {
            const headers = {};
            
            // CSRF token varsa ekle
            if (CSRF_TOKEN) {
                headers['X-CSRFToken'] = CSRF_TOKEN;
            }
            
            const response = await fetch(`/api/dilekce_kategorileri/${kategoriId}`, {
                method: 'DELETE',
                headers: headers
            });
            
            const result = await response.json();
            if (result.success) {
                showToast('Başarılı', 'Kategori başarıyla silindi.', 'success');
                kategorileriListele();
            } else {
                showToast('Hata', 'Kategori silinirken hata: ' + result.message, 'error');
            }
        } catch (error) {
            console.error('Kategori silme hatası:', error);
            showToast('Hata', 'Kategori silinirken bir ağ hatası oluştu.', 'error');
        }
    }

    async function kategoriDuzenle(kategoriId, mevcutAd) {
        const yeniAd = prompt('Yeni kategori adını girin:', mevcutAd);
        if (!yeniAd || yeniAd.trim() === '' || yeniAd.trim() === mevcutAd) {
            return;
        }
        
        try {
            const headers = {
                'Content-Type': 'application/json'
            };
            
            // CSRF token varsa ekle
            if (CSRF_TOKEN) {
                headers['X-CSRFToken'] = CSRF_TOKEN;
            }
            
            const response = await fetch(`/api/dilekce_kategorileri/${kategoriId}`, {
                method: 'PUT',
                headers: headers,
                body: JSON.stringify({ ad: yeniAd.trim() })
            });
            
            const result = await response.json();
            if (result.success) {
                showToast('Başarılı', 'Kategori başarıyla güncellendi.', 'success');
                kategorileriListele();
            } else {
                showToast('Hata', 'Kategori güncellenirken hata: ' + result.message, 'error');
            }
        } catch (error) {
            console.error('Kategori güncelleme hatası:', error);
            showToast('Hata', 'Kategori güncellenirken bir ağ hatası oluştu.', 'error');
        }
    }

    // Dilekçe Fonksiyonları
    async function dilekceYukle() {
        const dosyaInput = document.getElementById('dilekceDosyasi');
        const kategoriSelect = document.getElementById('dilekceKategorisi');
        const dilekceAdiInput = document.getElementById('yeniDilekceAdi'); // Opsiyonel dilekce adı için
        const dosya = dosyaInput.files[0];
        const kategoriId = kategoriSelect.value;
        const dilekceAdi = dilekceAdiInput ? dilekceAdiInput.value.trim() : '';


        if (!dosya) {
            showToast('Uyarı', 'Lütfen bir dosya seçin.', 'warning');
            return;
        }
        if (!kategoriId || kategoriId === '') { // Kategori seçili olmalı
            showToast('Uyarı', 'Lütfen bir kategori seçin.', 'warning');
            return;
        }

        // Yükleme başladı bildirimi
        showToast('Bilgi', 'Dilekçe yükleniyor...', 'info');

        const formData = new FormData();
        formData.append('dilekceDosyasi', dosya);
        formData.append('kategoriId', kategoriId);
        if (dilekceAdi) { // Sadece doluysa gönder
            formData.append('dilekceAdi', dilekceAdi);
        }

        console.log('Dilekçe yükleniyor...');
        try {
            const response = await fetch('/api/ornek_dilekceler', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': CSRF_TOKEN 
                },
                body: formData
            });
            const result = await response.json();
            if (result.success) {
                showToast('Başarılı', 'Dilekçe başarıyla yüklendi.', 'success');
                dilekceleriListele(kategoriId); // Yükleme sonrası listeyi güncelle
                dosyaInput.value = ''; 
                kategoriSelect.value = ''; 
                if(dilekceAdiInput) dilekceAdiInput.value = '';
            } else {
                showToast('Hata', 'Dilekçe yüklenirken hata: ' + result.message, 'error');
            }
        } catch (error) {
            console.error('Dilekçe yükleme hatası:', error);
            showToast('Hata', 'Dilekçe yüklenirken bir ağ hatası oluştu.', 'error');
        }
    }

    async function dilekceleriListele(kategoriId = null) {
        console.log('Dilekçeler listeleniyor, Kategori ID:', kategoriId || 'Tümü');
        let url = '/api/ornek_dilekceler';
        if (kategoriId && kategoriId !== '') {
            url += `?kategoriId=${kategoriId}`;
        }

        // Yükleniyor göster
        const tabloBody = document.getElementById('dilekceTablosuBody');
        tabloBody.innerHTML = `
            <tr>
                <td colspan="4" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Yükleniyor...</span>
                    </div>
                    <p class="mt-2 text-muted">Dilekçeler yükleniyor...</p>
                </td>
            </tr>
        `;

        try {
            const response = await fetch(url);
            const result = await response.json();

            if (!result.success) {
                showToast('Hata', 'Dilekçeler getirilirken hata: ' + result.message, 'error');
                return;
            }
            const dilekceler = result.dilekceler || [];
            tabloBody.innerHTML = '';

            if (dilekceler.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = 4;
                td.className = 'text-center py-4 text-muted';
                td.innerHTML = kategoriId ? 
                    '<i class="material-icons" style="font-size: 48px;">folder_open</i><p>Bu kategoride henüz dilekçe bulunmamaktadır.</p>' : 
                    '<i class="material-icons" style="font-size: 48px;">inbox</i><p>Henüz hiç dilekçe yüklenmemiş.</p>';
                tr.appendChild(td);
                tabloBody.appendChild(tr);
                return;
            }

            dilekceler.forEach(dilekce => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <i class="material-icons text-muted me-2">description</i>
                            <div>${dilekce.ad}</div>
                        </div>
                    </td>
                    <td>
                        <span class="badge bg-secondary">${dilekce.kategori}</span>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <i class="material-icons text-muted me-2">calendar_today</i>
                            <div>${dilekce.tarih}</div>
                        </div>
                    </td>
                    <td>
                        <div class="d-flex justify-content-center">
                            <button class="btn btn-sm btn-outline-secondary mx-1" onclick="window.onizlemeDilekce('${dilekce.id}', '${dilekce.ad}')">
                                <i class="material-icons">visibility</i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary mx-1" onclick="indirDilekce('${dilekce.id}')">
                                <i class="material-icons">download</i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary mx-1" onclick="dilekceDuzenleAd('${dilekce.id}', '${dilekce.ad}')">
                                <i class="material-icons">edit</i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary mx-1" onclick="silDilekce('${dilekce.id}')">
                                <i class="material-icons">delete</i>
                            </button>
                        </div>
                    </td>
                `;
                tabloBody.appendChild(tr);
            });
            console.log('Dilekçeler yüklendi.');
        } catch (error) {
            console.error('Dilekçeleri listeleme hatası:', error);
            showToast('Hata', 'Dilekçeler getirilirken bir ağ hatası oluştu.', 'error');
            
            // Hata durumunda mesaj göster
            tabloBody.innerHTML = `
                <tr>
                    <td colspan="4" class="text-center py-4">
                        <i class="material-icons text-danger" style="font-size: 48px;">error</i>
                        <p class="text-danger">Dilekçeler yüklenirken bir hata oluştu.</p>
                        <button class="btn btn-sm btn-outline-primary mt-2" onclick="dilekceleriListele('${kategoriId}')">
                            <i class="material-icons align-middle me-1">refresh</i> Yeniden Dene
                        </button>
                    </td>
                </tr>
            `;
        }
    }

    // Bu fonksiyon artık kullanılmıyor - window.onizlemeDilekce kullanılıyor

    // Eski fonksiyonlar kaldırıldı - artık window.onizlemeDilekce kullanılıyor

    function dilekceIndir(dilekceId) {
        console.log('İndirilecek dilekçe ID:', dilekceId);
        
        // İndirme başladı bildirimi
        showToast('Bilgi', 'Dilekçe indiriliyor...', 'info');
        
        // İndirme bağlantısı
        window.location.href = `/api/ornek_dilekceler/${dilekceId}/indir`;
    }

    async function dilekceDuzenleAd(dilekceId, mevcutAd) {
        console.log('Düzenlenecek dilekçe ID:', dilekceId);
        
        // Daha modern bir şekilde ad düzenleme - prompt yerine custom modal kullanılabilir
        // Şimdilik prompt ile devam edelim
        const yeniAd = prompt(`"${mevcutAd}" için yeni bir ad girin (uzantıyı koruyun veya dosya adınızdan emin olun):`, mevcutAd);
        
        if (yeniAd && yeniAd.trim() !== mevcutAd.trim()) {
            // Güncelleme başladı bildirimi
            showToast('Bilgi', 'Dilekçe adı güncelleniyor...', 'info');
            
            try {
                const response = await fetch(`/api/ornek_dilekceler/${dilekceId}/duzenle_ad`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': CSRF_TOKEN
                    },
                    body: JSON.stringify({ yeni_ad: yeniAd.trim() })
                });
                const result = await response.json();
                if (result.success) {
                    showToast('Başarılı', 'Dilekçe adı başarıyla güncellendi.', 'success');
                    dilekceleriListele(document.getElementById('listelenecekKategori').value);
                } else {
                    showToast('Hata', 'Dilekçe adı güncellenirken hata: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Dilekçe adı güncelleme hatası:', error);
                showToast('Hata', 'Dilekçe adı güncellenirken bir ağ hatası oluştu.', 'error');
            }
        }
    }

    function dilekceSil(dilekceId, dilekceAdi) {
        const silOnayModalEl = document.getElementById('silOnayModal');
        const silOnayModal = bootstrap.Modal.getInstance(silOnayModalEl) || new bootstrap.Modal(silOnayModalEl);
        document.getElementById('silinecekOgeId').value = dilekceId;
        document.getElementById('silinecekOgeTuru').value = 'dilekce';
        const modalBody = silOnayModalEl.querySelector('.modal-body');
        if (modalBody) {
             let textNode = modalBody.firstChild;
            while(textNode && textNode.nodeType !== Node.TEXT_NODE && textNode.firstChild) { // Sadece ilk text node'u değil, iç içe elementlerdeki ilk text node'u bul
                textNode = textNode.firstChild;
            }
            if (textNode && textNode.nodeType === Node.TEXT_NODE) { // Emin olalım ki bir text node
                 textNode.textContent = `"${dilekceAdi}" adlı dilekçeyi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz. `;
            } else {
                // Fallback eğer metin düğümü bulunamazsa veya yanlış türdeyse
                const p = modalBody.querySelector('p'); // Ya da daha spesifik bir selektör
                if(p) p.textContent = `"${dilekceAdi}" adlı dilekçeyi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz. `;
                else modalBody.insertBefore(document.createTextNode(`"${dilekceAdi}" adlı dilekçeyi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz. `), modalBody.firstChild);
            }
        }
        silOnayModal.show();
    }

    async function onaylaSil() {
        const id = document.getElementById('silinecekOgeId').value;
        const tur = document.getElementById('silinecekOgeTuru').value;
        const silOnayModalEl = document.getElementById('silOnayModal');
        const silOnayModal = bootstrap.Modal.getInstance(silOnayModalEl);

        // İşlem başladı bildirimi
        showToast('Bilgi', `${tur.charAt(0).toUpperCase() + tur.slice(1)} siliniyor...`, 'info');
        
        if (tur === 'kategori') {
            console.log('Kategori silinecek, ID:', id);
            try {
                const response = await fetch(`/api/dilekce_kategorileri/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': CSRF_TOKEN 
                    }
                });
                const result = await response.json();
                if (result.success) {
                    showToast('Başarılı', 'Kategori başarıyla silindi.', 'success');
                    kategorileriListele(); 
                    dilekceleriListele(); 
                } else {
                    showToast('Hata', 'Kategori silinirken hata: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Kategori silme hatası:', error);
                showToast('Hata', 'Kategori silinirken bir ağ hatası oluştu.', 'error');
            }
        } else if (tur === 'dilekce') {
            console.log('Dilekçe silinecek, ID:', id);
            try {
                const response = await fetch(`/api/ornek_dilekceler/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': CSRF_TOKEN
                    }
                });
                const result = await response.json();
                if (result.success) {
                    showToast('Başarılı', 'Dilekçe başarıyla silindi.', 'success');
                    dilekceleriListele(document.getElementById('listelenecekKategori').value); 
                } else {
                    showToast('Hata', 'Dilekçe silinirken hata: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Dilekçe silme hatası:', error);
                showToast('Hata', 'Dilekçe silinirken bir ağ hatası oluştu.', 'error');
            }
        }
        silOnayModal.hide();
    }

    // Toast Bildirimi Gösterme Fonksiyonu
    function showToast(title, message, type = 'info') {
        // Eğer toast container yoksa oluştur
        let toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            document.body.appendChild(toastContainer);
        }
        
        // Toast elementini oluştur
        const toastId = 'toast-' + Date.now();
        const toastHtml = `
            <div id="${toastId}" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header ${type === 'success' ? 'bg-light text-success' : type === 'error' ? 'bg-light text-danger' : 'bg-light text-info'}">
                    <strong class="me-auto">${title}</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            </div>
        `;
        
        toastContainer.insertAdjacentHTML('beforeend', toastHtml);
        
        const toastElement = document.getElementById(toastId);
        const toast = new bootstrap.Toast(toastElement);
        toast.show();
        
        // Toast kapandıktan sonra DOM'dan kaldır
        toastElement.addEventListener('hidden.bs.toast', function () {
            toastElement.remove();
        });
    }

    // DOSYA ÖNİZLEME - GELİŞTİRİLMİŞ VERSİYON
    window.onizlemeDilekce = function(dilekceId, dosyaAdi) {
        console.log('🚀 Dilekçe önizleme başlatılıyor:', dilekceId, dosyaAdi);
        console.log('🔧 onizlemeDilekce fonksiyonu çağrıldı!');
        
        // Body scroll engelle
        document.body.classList.add('modal-open');
        
        // Dosya uzantısını belirle
        let ext = '';
        if (dosyaAdi && dosyaAdi.includes('.')) {
            ext = dosyaAdi.split('.').pop().toLowerCase();
        }
        console.log('📁 Tespit edilen dosya uzantısı:', ext);
        
        try {
            showPreviewModal(dilekceId, dosyaAdi, ext);
        } catch (error) {
            console.error('❌ Modal gösterme hatası:', error);
            document.body.classList.remove('modal-open');
            alert('Modal açılırken hata oluştu: ' + error.message);
        }
    };

    // Önizleme modalını göster - Geliştirilmiş versiyon
    function showPreviewModal(dilekceId, filename, ext) {
        console.log('📋 Modal oluşturuluyor:', filename, ext);
        console.log('🔧 showPreviewModal fonksiyonu çağrıldı!');
        
        // Önceki modalları temizle
        const existingModals = document.querySelectorAll('.file-detail-modal, #previewModal, [id*="modal"], [class*="modal"]');
        existingModals.forEach(modal => {
            if (modal.classList.contains('file-detail-modal') || modal.id === 'previewModal') {
                modal.remove();
                console.log('🗑️ Önceki modal kaldırıldı:', modal.id || modal.className);
            }
        });
        
        // Modal wrapper oluştur
        const previewModal = document.createElement('div');
        previewModal.id = 'previewModal';
        previewModal.className = 'file-detail-modal';
        previewModal.style.cssText = `
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: rgba(0, 0, 0, 0.9) !important;
            z-index: 2147483647 !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            margin: 0 !important;
            padding: 0 !important;
        `;
        
        // Modal content oluştur
        const modalContentElement = document.createElement('div');
        modalContentElement.className = 'preview-modal-content';
        modalContentElement.style.cssText = `
            width: calc(100vw - 40px) !important;
            height: calc(100vh - 40px) !important;
            background: white !important;
            border-radius: 8px !important;
            display: flex !important;
            flex-direction: column !important;
            overflow: hidden !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5) !important;
            margin: 20px !important;
        `;
        
        console.log('✅ Modal content elementi oluşturuldu');

        const previewHtml = `
            <div class="modal-header" style="background: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; height: 60px; border-radius: 8px 8px 0 0;">
                <h2 style="margin: 0; font-size: 1.25rem; color: #212529; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">📋 ${filename || 'Bilinmeyen Dosya'}</h2>
                <button class="close-btn" onclick="closePreviewModal()" style="background: none; border: none; font-size: 1.5rem; color: #6c757d; cursor: pointer; padding: 8px; border-radius: 4px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <div class="preview-modal-body" style="flex: 1; display: flex; flex-direction: column; overflow: hidden; background: #fff; height: calc(100% - 60px);">
                <div class="document-preview-container" id="previewContainer-${dilekceId}" style="flex: 1; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; background: white; overflow: auto;">
                    <div style="text-align: center; padding: 40px;">
                        <div style="border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                        <p style="color: #666; font-size: 16px;">Dosya yükleniyor...</p>
                        <style>
                            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
                        </style>
                    </div>
                </div>
            </div>
        `;
        modalContentElement.innerHTML = previewHtml;
        previewModal.appendChild(modalContentElement);
        
        // Event listener'lar ekle
        previewModal.addEventListener('click', function(e) {
            if (e.target === previewModal) {
                closePreviewModal();
            }
        });
        
        // Close button event listener
        const closeBtn = modalContentElement.querySelector('.close-btn');
        if (closeBtn) {
            closeBtn.addEventListener('click', closePreviewModal);
        }
        
        // DOM'a ekle
        document.body.appendChild(previewModal);
        
        console.log('✅ Modal DOM\'a eklendi ve görünür yapıldı');
        console.log('📱 Modal elementi:', previewModal);

        const previewContainer = document.getElementById(`previewContainer-${dilekceId}`);

        function showError(message) {
            previewContainer.style.cssText = 'flex: 1; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; background: white;';
            previewContainer.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <i class="material-icons" style="font-size: 48px; color: #999;">error_outline</i>
                    <p style="margin-top: 15px; font-size: 1.1rem; color: #555;">${message}</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #777;">Belgeyi görüntülemek için lütfen indirin.</p>
                    <button class="btn" onclick="indirDilekce(${dilekceId})" style="margin-top: 20px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                        <i class="material-icons" style="font-size: 18px;">download</i> İndir
                    </button>
                </div>
            `;
        }

        // Dosya türüne göre önizleme - geliştirilmiş
        setTimeout(() => {
            console.log('📥 Dosya türü işleniyor:', ext);
            
            if (ext === 'pdf' || ext === 'txt') {
                const previewUrl = `/api/ornek_dilekceler/${dilekceId}/onizle`;
                previewContainer.style.cssText = 'flex: 1; width: 100%; height: 100%; background: #f5f5f5; overflow: hidden;';
                previewContainer.innerHTML = `<iframe src="${previewUrl}" frameborder="0" style="width: 100%; height: 100%; border: none; background: white;"></iframe>`;
                console.log('📄 PDF/TXT iframe yüklendi:', previewUrl);
            } else if (['png', 'jpg', 'jpeg', 'gif', 'bmp', 'webp'].includes(ext)) {
                const previewUrl = `/api/ornek_dilekceler/${dilekceId}/onizle`;
                previewContainer.style.cssText = 'flex: 1; width: 100%; height: 100%; background: #f5f5f5; display: flex; justify-content: center; align-items: center; overflow: auto;';
                previewContainer.innerHTML = `<img src="${previewUrl}" alt="Dilekçe önizleme" style="max-width: 100%; max-height: 100%; object-fit: contain; background: white;">`;
                console.log('🖼️ Resim yüklendi:', previewUrl);
            } else if (ext === 'docx' || ext === 'doc') {
                // DOCX/DOC dosyaları için HTML önizleme
                console.log('📃 DOCX/DOC dosyası tespit edildi, HTML önizleme yapılacak:', dilekceId);
                
                const previewUrl = `/api/ornek_dilekceler/${dilekceId}/onizle`;
                previewContainer.style.cssText = 'flex: 1; width: 100%; height: 100%; background: #f5f5f5; overflow: hidden;';
                previewContainer.innerHTML = `<iframe src="${previewUrl}" frameborder="0" style="width: 100%; height: 100%; border: none; background: white;"></iframe>`;
                
                console.log('📃 DOCX/DOC iframe yüklendi:', previewUrl);
            } else if (ext === 'udf') {
                // UDF dosyasını doğrudan uygulama içinde görüntüle
                const previewUrl = `/direct_view_udf_dilekce/${dilekceId}`;
                previewContainer.style.cssText = 'flex: 1; width: 100%; height: 100%; background: #f5f5f5; overflow: hidden;';
                previewContainer.innerHTML = `<iframe src="${previewUrl}" frameborder="0" style="width: 100%; height: 100%; border: none; background: white;"></iframe>`;
                console.log('🔤 UDF iframe yüklendi:', previewUrl);
            } else {
                showError(`${ext ? ext.toUpperCase() : 'Bu'} dosya türü için önizleme desteklenmiyor.`);
            }
        }, 300);
    }

    // Modal kapatma fonksiyonu - geliştirilmiş
    function closePreviewModal() {
        console.log('🗑️ Modal kapatma işlemi başlatıldı');
        
        // Body scroll'u tekrar aç
        document.body.classList.remove('modal-open');
        
        // Tüm modalları temizle
        const modals = document.querySelectorAll('.file-detail-modal, #previewModal, [class*="file-detail-modal"], [id*="previewModal"]');
        modals.forEach(modal => {
            try {
                modal.remove();
                console.log('🗑️ Modal kaldırıldı:', modal.id || modal.className);
            } catch (error) {
                console.error('Modal kaldırma hatası:', error);
            }
        });
        
        console.log('✅ Tüm modallar temizlendi');
    }

    // ESC tuşu ve diğer event listener'lar
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const activeModal = document.querySelector('.file-detail-modal, #previewModal');
            if (activeModal) {
                closePreviewModal();
            }
        }
    });

    // Sayfa yeniden yüklendiğinde modal cleanup
    window.addEventListener('beforeunload', function() {
        document.body.classList.remove('modal-open');
    });

    // Dilekçe indirme fonksiyonu
    window.indirDilekce = function(dilekceId) {
        console.log('Dilekçe indiriliyor:', dilekceId);
        
        try {
            const link = document.createElement('a');
            link.href = `/api/ornek_dilekceler/${dilekceId}/indir`;
            link.download = '';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Başarılı', 'Dosya indirme başlatıldı', 'success');
        } catch (error) {
            console.error('İndirme hatası:', error);
            showToast('Hata', 'Dosya indirilemedi', 'error');
        }
    };



    // Dilekçe silme fonksiyonu
    window.silDilekce = function(dilekceId) {
        console.log('Dilekçe siliniyor:', dilekceId);
        
        if (!confirm('Bu dilekçeyi silmek istediğinizden emin misiniz?')) {
            return;
        }
        
        try {
            fetch(`/api/ornek_dilekceler/${dilekceId}`, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': CSRF_TOKEN
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('Başarılı', 'Dilekçe başarıyla silindi', 'success');
                    // Sayfayı yenile
                    window.location.reload();
                } else {
                    showToast('Hata', data.message || 'Dilekçe silinemedi', 'error');
                }
            })
            .catch(error => {
                console.error('Silme hatası:', error);
                showToast('Hata', 'Silme işlemi sırasında hata oluştu', 'error');
            });
        } catch (error) {
            console.error('Silme işlemi hatası:', error);
            showToast('Hata', 'İşlem sırasında bir hata oluştu', 'error');
        }
    };

    // Tablo sıralama fonksiyonu
    let sortDirection = {}; // Her sütun için sıralama yönünü takip et

    function sortTable(columnIndex) {
        const table = document.getElementById('dilekceTablosu');
        const tbody = document.getElementById('dilekceTablosuBody');
        const rows = Array.from(tbody.rows);
        
        // Boş tablo kontrolü
        if (rows.length === 0 || (rows.length === 1 && rows[0].cells[0].colSpan > 1)) {
            return;
        }
        
        // Sıralama yönünü belirle
        const currentDirection = sortDirection[columnIndex] || 'none';
        let newDirection;
        
        if (currentDirection === 'none' || currentDirection === 'desc') {
            newDirection = 'asc';
        } else {
            newDirection = 'desc';
        }
        
        sortDirection[columnIndex] = newDirection;
        
        // Tüm başlık sınıflarını temizle
        const headers = table.querySelectorAll('.sortable');
        headers.forEach(header => {
            header.classList.remove('asc', 'desc');
            const icon = header.querySelector('.sort-icon');
            if (icon) {
                icon.textContent = 'unfold_more';
            }
        });
        
        // Aktif başlığı işaretle
        const activeHeader = headers[columnIndex];
        activeHeader.classList.add(newDirection);
        const activeIcon = activeHeader.querySelector('.sort-icon');
        if (activeIcon) {
            activeIcon.textContent = newDirection === 'asc' ? 'keyboard_arrow_up' : 'keyboard_arrow_down';
        }
        
        // Satırları sırala
        rows.sort((a, b) => {
            let aVal, bVal;
            
            if (columnIndex === 0) { // Dilekçe Adı
                aVal = a.cells[0].querySelector('div:last-child').textContent.trim().toLowerCase();
                bVal = b.cells[0].querySelector('div:last-child').textContent.trim().toLowerCase();
            } else if (columnIndex === 1) { // Kategori
                aVal = a.cells[1].querySelector('.badge').textContent.trim().toLowerCase();
                bVal = b.cells[1].querySelector('.badge').textContent.trim().toLowerCase();
            } else if (columnIndex === 2) { // Yüklenme Tarihi
                aVal = a.cells[2].querySelector('div:last-child').textContent.trim();
                bVal = b.cells[2].querySelector('div:last-child').textContent.trim();
                
                // Tarihi çevir (dd.mm.yyyy formatından Date objesine)
                const parseDate = (dateStr) => {
                    const parts = dateStr.split('.');
                    if (parts.length === 3) {
                        return new Date(parts[2], parts[1] - 1, parts[0]);
                    }
                    return new Date(dateStr);
                };
                
                aVal = parseDate(aVal);
                bVal = parseDate(bVal);
            }
            
            if (columnIndex === 2) { // Tarih karşılaştırması
                if (newDirection === 'asc') {
                    return aVal - bVal;
                } else {
                    return bVal - aVal;
                }
            } else { // String karşılaştırması
                if (newDirection === 'asc') {
                    return aVal.localeCompare(bVal, 'tr');
                } else {
                    return bVal.localeCompare(aVal, 'tr');
                }
            }
        });
        
        // Sıralanmış satırları tabloya geri ekle
        rows.forEach(row => tbody.appendChild(row));
    }

    // Sayfa yüklendiğinde ilk listelemeleri yap
    document.addEventListener('DOMContentLoaded', function () {
        console.log('🚀 Örnek dilekçeler sayfası yüklendi');
        
        // Modern CSS test
        const testBox = document.querySelector('.kategori-yonetimi-box');
        if (testBox) {
            const computedStyle = window.getComputedStyle(testBox);
            console.log('✅ Kategori yönetimi box bulundu');
            console.log('📋 Background:', computedStyle.background);
            console.log('📋 Border-radius:', computedStyle.borderRadius);
            console.log('📋 Box-shadow:', computedStyle.boxShadow);
        } else {
            console.log('❌ Kategori yönetimi box bulunamadı');
        }
        
        console.log('📋 Kategoriler ve dilekçeler yükleniyor...');
        kategorileriListele();
        dilekceleriListele(); // Başlangıçta tüm dilekçeleri listele
        
        // Enter tuşuna basıldığında kategori ekleme işlemini gerçekleştir
        document.getElementById('yeniKategoriAdi').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                kategoriEkle();
            }
        });

        // Sık kullanılan seçim kutularına daha iyi bir genişlik sağla
        const genisElementler = document.querySelectorAll('#dilekceKategorisi, #listelenecekKategori');
        genisElementler.forEach(element => {
            element.style.minWidth = '100%';
        });

        const kategoriEkleBtn = document.getElementById('kategoriEkleBtn');
        if (kategoriEkleBtn) {
            kategoriEkleBtn.addEventListener('click', kategoriEkle);
        }
    });
</script>
{% endblock %} 