{% extends "layout.html" %}

{% block title %}Vekaletname{% endblock %}

{% block content %}
<div class="page-container" style="max-width: 900px; margin: 0 auto;">
    <div class="card" style="padding: 20px;">
        <div class="d-flex justify-content-between align-items-center no-print" style="margin-bottom: 15px;">
            <h3 style="margin: 0;">Vekaletname Metni</h3>
            <div class="d-flex gap-2">
                <button id="printBtn" class="btn btn-primary">Yazdır</button>
                <button id="toggleEditBtn" class="btn btn-secondary">Düzenle</button>
            </div>
        </div>

        <div id="editor" contenteditable="true" style="background: #ffffff; border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; min-height: 400px;">
            <p style="text-align: center; font-weight: 700; text-decoration: underline;">AHZU KABZA SULH VE İBRAYA DAVADAN İSTİNAFTAN, TEMYİZDEN VE DİĞER KANUN YOLLARINDAN FERAGATE ARABULUCULUĞA BAŞVURMAYA DİLEDİĞİNDE DAVA DURUŞMALARINA MESLEKİ MAZERET GÖSTERMEYE , DİLEDİĞİ AVUKATA YETKİLENDİRME YETKİSİNİ TAŞIR GENEL VEKALETNAME VERİLECEK</p>

            <p style="text-align: center; font-weight: 700; margin-top: 24px;">KAPLAN HUKUK BÜROSU<br>Av.Mustafa KAPLAN<br>Güneşli VD: 68884068806</p>

            <p style="text-align: center; margin-top: 16px;">Adres: Güneşli Meydanı Cumhuriyet Cad. No:47/32 Kat:3 Daire :8<br>Güneşli/Bağcılar/İstanbul</p>

            <p style="text-align: center; font-weight: 700; margin-top: 24px;">SİGORTALI OLARAK ÇALIŞAN AVUKATLAR</p>

            <table style="width: 80%; margin: 16px auto 0 auto; text-align: center;">
                <tr>
                    <td style="width: 50%; vertical-align: top;">
                        <p><strong>Av. Batuhan KAPLAN</strong><br>TC No: 68857069762</p>
                    </td>
                    <td style="width: 50%; vertical-align: top;">
                        <p><strong>Av. Selvi DERTLİ</strong><br>TC No : 42100348798</p>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>

<style>
/* Yazdırma için optimize edilmiş görünüm */
@media print {
    @page { size: A4 landscape; margin: 0; }
    html, body { margin: 0 !important; padding: 0 !important; height: 100% !important; }

    /* Uygulama kromunu gizle */
    .sidebar, header, .site-footer, .profile-menu, .search-container, .ai-avukat-btn { display: none !important; }
    .no-print { display: none !important; }

    /* Ana içerik alanını sıfırla */
    .app-container, .main-wrapper, .content, .page-container, .card {
        margin: 0 !important;
        padding: 0 !important;
        border: none !important;
        box-shadow: none !important;
        background: #fff !important;
    }

    /* Sayfayı tek sayfada doldur */
    .page-container { width: 297mm !important; max-width: none !important; }
    #editor {
        width: 297mm; height: 210mm;
        padding: 10mm; box-sizing: border-box;
        background: #fff !important; border: none !important; border-radius: 0 !important;
        -webkit-print-color-adjust: exact; print-color-adjust: exact;
        font-size: 12pt;
        overflow: hidden;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const editor = document.getElementById('editor');
    const printBtn = document.getElementById('printBtn');
    const toggleBtn = document.getElementById('toggleEditBtn');
    // Vekaletname içeriğini localStorage'dan yükle (varsa)
    try {
        const saved = localStorage.getItem('vekaletname_content');
        if (saved) {
            editor.innerHTML = saved;
        }
    } catch (e) { /* ignore */ }

    printBtn.addEventListener('click', function() {
        const wasEditable = editor.getAttribute('contenteditable');
        editor.setAttribute('contenteditable', 'false');
        window.getSelection && window.getSelection().removeAllRanges && window.getSelection().removeAllRanges();
        setTimeout(() => {
            window.print();
            editor.setAttribute('contenteditable', wasEditable);
        }, 50);
    });

    toggleBtn.addEventListener('click', function() {
        const isEditable = editor.getAttribute('contenteditable') === 'true';
        if (!isEditable) {
            // Düzenlemeyi aç
            editor.setAttribute('contenteditable', 'true');
            toggleBtn.textContent = 'Kaydet';
            showGlobalNotification('Düzenleme etkin.', 'info');
        } else {
            // Kaydet ve kapat
            try {
                localStorage.setItem('vekaletname_content', editor.innerHTML);
                showGlobalNotification('Vekaletname metni kaydedildi.', 'success');
            } catch (e) {
                showGlobalNotification('Kaydedilemedi.', 'error');
            }
            editor.setAttribute('contenteditable', 'false');
            toggleBtn.textContent = 'Düzenle';
        }
    });

    function saveContent() {
        try {
            localStorage.setItem('vekaletname_content', editor.innerHTML);
            showGlobalNotification('Vekaletname metni yerel olarak kaydedildi.', 'success');
        } catch (e) {
            showGlobalNotification('Kaydetme sırasında hata oluştu.', 'error');
        }
    }
    // Otomatik kaydetme (debounce)
    let saveTimer;
    editor.addEventListener('input', function() {
        clearTimeout(saveTimer);
        saveTimer = setTimeout(saveContent, 800);
    });
    // Yapıştırmaya izin ver (varsayılan izinli, ama kontrol edelim)
    editor.addEventListener('paste', function(e) {
        // Biçimlendirmeyi sadeleştir: düz metin olarak yapıştır
        e.preventDefault();
        const text = (e.clipboardData || window.clipboardData).getData('text');
        document.execCommand('insertText', false, text);
    });
});
</script>
{% endblock %}


