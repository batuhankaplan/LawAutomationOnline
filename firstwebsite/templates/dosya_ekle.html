{% extends "layout.html" %}

{% block title %}Dosya Ekle{% endblock %}

{% block content %}
<header>
    <div class="header-left">
        <h1>Dosya Ekle</h1>
        <button id="uyapSyncBtn" class="btn" style="margin-left: 15px;">
            <i class="fas fa-sync-alt"></i> UYAP'tan Dosyaları Çek
        </button>
    </div>
</header>

<div class="container">
    <form method="POST" id="addCaseForm" class="case-form">
        
        <div class="main-sections">
            <!-- Dosya Bilgileri -->
            <div class="form-section">
                <div class="section-header">
                    <h3><i class="material-icons">folder</i> Dosya Bilgileri</h3>
                </div>
                <div class="section-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="file-type">Dosya Türü *</label>
                            <select id="file-type" name="file-type" onchange="handleFileTypeChange()" required>
                                <option value="">Seçiniz</option>
                                <option value="hukuk">Hukuk</option>
                                <option value="ceza">Ceza</option>
                                <option value="icra">İcra</option>
                                <option value="savcilik">Savcılık</option>
                                <option value="ARABULUCULUK">Arabuluculuk</option>
                                <option value="AİHM">AİHM</option>
                                <option value="AYM">AYM</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="year">Yıl *</label>
                            <input type="number" id="year" name="year" required>
                        </div>

                        <div class="form-group">
                            <label for="case-number">Esas No *</label>
                            <input type="text" id="case-number" name="case-number" required>
                        </div>

                        <div class="form-group">
                            <label for="city">Şehir</label>
                            <select id="city" name="city" onchange="updateCourthouses()">
                                <option value="">Seçiniz</option>
                                {% for city_name in cities %}
                                    <option value="{{ city_name }}">{{ city_name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="courthouse">Adliye</label>
                            <select id="courthouse" name="courthouse">
                                <option value="">Önce Şehir Seçiniz</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="department">Mahkeme</label>
                            <select id="department" name="department">
                                <option value="">Seçiniz</option>
                            </select>
                        </div>

                        <div class="form-group" id="court-number-container">
                            <label for="court-number">Numaralı Mahkeme</label>
                            <select id="court-number" name="court-number">
                                <option value="">Seçiniz</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="open-date">Açılış Tarihi *</label>
                            <input type="date" id="open-date" name="open-date" required value="{{ today_date }}">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Müvekkil Bilgileri -->
            <div class="form-section">
                <div class="section-header">
                    <h3><i class="material-icons">person</i> Müvekkil Bilgileri</h3>
                </div>
                <div class="section-content">
                    <!-- Kişi/Kurum Seçici -->
                    <div class="entity-type-selector">
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="client-entity-type" value="person" checked onchange="toggleClientEntityType()">
                                <span class="radio-label">Kişi</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="client-entity-type" value="company" onchange="toggleClientEntityType()">
                                <span class="radio-label">Kurum</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="client-capacity">Müvekkil Sıfatı *</label>
                            <select id="client-capacity" name="client-capacity" required>
                                <option value="">Önce Dosya Türü Seçiniz</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="client-name" id="client-name-label">Ad Soyad *</label>
                            <input type="text" id="client-name" name="client-name" required>
                        </div>

                        <div class="form-group">
                            <label for="client-phone">Telefon</label>
                            <input type="tel" id="client-phone" name="client-phone" pattern="[0-9]{10,11}" placeholder="5XX XXX XX XX">
                        </div>

                        <div class="form-group">
                            <label for="client-id" id="client-id-label">T.C. Kimlik No</label>
                            <input type="text" id="client-id" name="client-id" maxlength="11">
                        </div>

                        <div class="form-group full-width">
                            <label for="client-address">Adres</label>
                            <textarea id="client-address" name="client-address" rows="2"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Ek Müvekkil Ekle Butonu -->
                <div class="additional-section">
                    <button type="button" class="btn btn-secondary" id="addClientBtn">
                        <i class="material-icons">add</i>
                            Müvekkil Ekle
                    </button>
                    
                    <!-- Eklenen Müvekkiller Listesi -->
                    <div id="additionalClients" class="additional-list">
                        <!-- Dinamik olarak eklenecek -->
                    </div>
                </div>
            </div>

            <!-- Karşı Taraf Bilgileri -->
            <div class="form-section" id="opponent-section">
                <div class="section-header">
                    <h3><i class="material-icons">group</i> Karşı Taraf Bilgileri</h3>
                </div>
                <div class="section-content">
                    <!-- Kişi/Kurum Seçici -->
                    <div class="entity-type-selector">
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="opponent-entity-type" value="person" checked onchange="toggleOpponentEntityType()">
                                <span class="radio-label">Kişi</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="opponent-entity-type" value="company" onchange="toggleOpponentEntityType()">
                                <span class="radio-label">Kurum</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="opponent-capacity">Karşı Taraf Sıfatı *</label>
                            <select id="opponent-capacity" name="opponent-capacity" required>
                                <option value="">Önce Dosya Türü Seçiniz</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="opponent-name" id="opponent-name-label">Ad Soyad</label>
                            <input type="text" id="opponent-name" name="opponent-name">
                        </div>

                        <div class="form-group">
                            <label for="opponent-phone">Telefon</label>
                            <input type="tel" id="opponent-phone" name="opponent-phone" pattern="[0-9]{10,11}" placeholder="5XX XXX XX XX">
                        </div>

                        <div class="form-group">
                            <label for="opponent-id" id="opponent-id-label">T.C. Kimlik No</label>
                            <input type="text" id="opponent-id" name="opponent-id" maxlength="11">
                        </div>

                        <div class="form-group full-width">
                            <label for="opponent-address">Adres</label>
                            <textarea id="opponent-address" name="opponent-address" rows="2"></textarea>
                        </div>

                        <!-- Vekil Bilgileri - Başlangıçta Gizli -->
                        <div id="opponent-lawyer-section" style="display: none;" class="lawyer-section full-width">
                            <h4 style="margin: 20px 0 15px 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px;">
                                <i class="material-icons" style="vertical-align: middle; margin-right: 5px;">account_balance</i>
                                Vekil Bilgileri
                            </h4>
                            <div class="form-grid lawyer-form-grid">
                                <div class="form-group">
                                    <label for="opponent-lawyer">Vekil Adı Soyadı</label>
                                    <input type="text" id="opponent-lawyer" name="opponent-lawyer">
                                </div>

                                <div class="form-group">
                                    <label for="opponent-lawyer-bar-number">Baro Numarası</label>
                                    <input type="text" id="opponent-lawyer-bar-number" name="opponent-lawyer-bar-number" placeholder="Baro sicil numarası">
                                </div>

                                <div class="form-group">
                                    <label for="opponent-lawyer-phone">Vekil Telefonu</label>
                                    <input type="tel" id="opponent-lawyer-phone" name="opponent-lawyer-phone" pattern="[0-9]{10,11}" placeholder="5XX XXX XX XX">
                                </div>

                                <div class="form-group full-width">
                                    <label for="opponent-lawyer-address">Vekil Adresi</label>
                                    <textarea id="opponent-lawyer-address" name="opponent-lawyer-address" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ek Karşı Taraf Ekle Butonu -->
                <div class="additional-section">
                    <div class="button-group" style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button type="button" class="btn btn-secondary" id="addOpponentBtn">
                            <i class="material-icons">add</i>
                            Karşı Taraf Ekle
                        </button>
                        <button type="button" class="btn btn-secondary" id="addLawyerBtn" onclick="showLawyerModal()">
                            <i class="material-icons">account_balance</i>
                            <span>Vekil Ekle</span>
                        </button>
                    </div>
                    
                    <!-- Vekil Gösterim Alanı -->
                    <div id="lawyer-display" class="additional-list" style="display: none;">
                        <!-- Dinamik olarak vekil kartı eklenecek -->
                    </div>
                    
                    <!-- Eklenen Karşı Taraflar Listesi -->
                    <div id="additionalOpponents" class="additional-list">
                        <!-- Dinamik olarak eklenecek -->
                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="material-icons">save</i>
                Dosyayı Kaydet
            </button>
        </div>
    </form>
</div>

<!-- Vekil Ekleme Modal -->
<div class="modal-overlay" id="lawyerModal" style="display: none;">
    <div class="modal-content-advanced">
        <div class="modal-header-simple">
            <div class="modal-title-section">
                <i class="material-icons">account_balance</i>
                <h3>Vekil Ekle</h3>
            </div>
            <button type="button" class="modal-close-advanced" onclick="closeLawyerModal()">
                <i class="material-icons">close</i>
            </button>
        </div>
        <div class="modal-body-advanced">
            <form id="lawyerForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="lawyer-name">Vekil Adı Soyadı *</label>
                        <input type="text" id="lawyer-name" required>
                    </div>
                    <div class="form-group">
                        <label for="lawyer-bar">Baro</label>
                        <select id="lawyer-bar">
                            <option value="">Seçiniz</option>
                            <option value="Adana Barosu">Adana Barosu</option>
                            <option value="Adıyaman Barosu">Adıyaman Barosu</option>
                            <option value="Afyonkarahisar Barosu">Afyonkarahisar Barosu</option>
                            <option value="Ağrı Barosu">Ağrı Barosu</option>
                            <option value="Aksaray Barosu">Aksaray Barosu</option>
                            <option value="Amasya Barosu">Amasya Barosu</option>
                            <option value="Ankara 1 Nolu Barosu">Ankara 1 Nolu Barosu</option>
                            <option value="Ankara 2 Nolu Barosu">Ankara 2 Nolu Barosu</option>
                            <option value="Antalya Barosu">Antalya Barosu</option>
                            <option value="Ardahan Barosu">Ardahan Barosu</option>
                            <option value="Artvin Barosu">Artvin Barosu</option>
                            <option value="Aydın Barosu">Aydın Barosu</option>
                            <option value="Balıkesir Barosu">Balıkesir Barosu</option>
                            <option value="Bartın Barosu">Bartın Barosu</option>
                            <option value="Batman Barosu">Batman Barosu</option>
                            <option value="Bayburt Barosu">Bayburt Barosu</option>
                            <option value="Bilecik Barosu">Bilecik Barosu</option>
                            <option value="Bingöl Barosu">Bingöl Barosu</option>
                            <option value="Bitlis Barosu">Bitlis Barosu</option>
                            <option value="Bolu Barosu">Bolu Barosu</option>
                            <option value="Burdur Barosu">Burdur Barosu</option>
                            <option value="Bursa Barosu">Bursa Barosu</option>
                            <option value="Çanakkale Barosu">Çanakkale Barosu</option>
                            <option value="Çankırı Barosu">Çankırı Barosu</option>
                            <option value="Çorum Barosu">Çorum Barosu</option>
                            <option value="Denizli Barosu">Denizli Barosu</option>
                            <option value="Diyarbakır Barosu">Diyarbakır Barosu</option>
                            <option value="Düzce Barosu">Düzce Barosu</option>
                            <option value="Edirne Barosu">Edirne Barosu</option>
                            <option value="Elazığ Barosu">Elazığ Barosu</option>
                            <option value="Erzincan Barosu">Erzincan Barosu</option>
                            <option value="Erzurum Barosu">Erzurum Barosu</option>
                            <option value="Eskişehir Barosu">Eskişehir Barosu</option>
                            <option value="Gaziantep Barosu">Gaziantep Barosu</option>
                            <option value="Giresun Barosu">Giresun Barosu</option>
                            <option value="Gümüşhane Barosu">Gümüşhane Barosu</option>
                            <option value="Hakkari Barosu">Hakkari Barosu</option>
                            <option value="Hatay Barosu">Hatay Barosu</option>
                            <option value="Iğdır Barosu">Iğdır Barosu</option>
                            <option value="Isparta Barosu">Isparta Barosu</option>
                            <option value="İstanbul 1 Nolu Barosu">İstanbul 1 Nolu Barosu</option>
                            <option value="İstanbul 2 Nolu Barosu">İstanbul 2 Nolu Barosu</option>
                            <option value="İzmir Barosu">İzmir Barosu</option>
                            <option value="Kahramanmaraş Barosu">Kahramanmaraş Barosu</option>
                            <option value="Karabük Barosu">Karabük Barosu</option>
                            <option value="Karaman Barosu">Karaman Barosu</option>
                            <option value="Kars Barosu">Kars Barosu</option>
                            <option value="Kastamonu Barosu">Kastamonu Barosu</option>
                            <option value="Kayseri Barosu">Kayseri Barosu</option>
                            <option value="Kırıkkale Barosu">Kırıkkale Barosu</option>
                            <option value="Kırklareli Barosu">Kırklareli Barosu</option>
                            <option value="Kırşehir Barosu">Kırşehir Barosu</option>
                            <option value="Kilis Barosu">Kilis Barosu</option>
                            <option value="Kocaeli Barosu">Kocaeli Barosu</option>
                            <option value="Konya Barosu">Konya Barosu</option>
                            <option value="Kütahya Barosu">Kütahya Barosu</option>
                            <option value="Malatya Barosu">Malatya Barosu</option>
                            <option value="Manisa Barosu">Manisa Barosu</option>
                            <option value="Mardin Barosu">Mardin Barosu</option>
                            <option value="Mersin Barosu">Mersin Barosu</option>
                            <option value="Muğla Barosu">Muğla Barosu</option>
                            <option value="Muş Barosu">Muş Barosu</option>
                            <option value="Nevşehir Barosu">Nevşehir Barosu</option>
                            <option value="Niğde Barosu">Niğde Barosu</option>
                            <option value="Ordu Barosu">Ordu Barosu</option>
                            <option value="Osmaniye Barosu">Osmaniye Barosu</option>
                            <option value="Rize Barosu">Rize Barosu</option>
                            <option value="Sakarya Barosu">Sakarya Barosu</option>
                            <option value="Samsun Barosu">Samsun Barosu</option>
                            <option value="Siirt Barosu">Siirt Barosu</option>
                            <option value="Sinop Barosu">Sinop Barosu</option>
                            <option value="Sivas Barosu">Sivas Barosu</option>
                            <option value="Şanlıurfa Barosu">Şanlıurfa Barosu</option>
                            <option value="Şırnak Barosu">Şırnak Barosu</option>
                            <option value="Tekirdağ Barosu">Tekirdağ Barosu</option>
                            <option value="Tokat Barosu">Tokat Barosu</option>
                            <option value="Trabzon Barosu">Trabzon Barosu</option>
                            <option value="Tunceli Barosu">Tunceli Barosu</option>
                            <option value="Uşak Barosu">Uşak Barosu</option>
                            <option value="Van Barosu">Van Barosu</option>
                            <option value="Yalova Barosu">Yalova Barosu</option>
                            <option value="Yozgat Barosu">Yozgat Barosu</option>
                            <option value="Zonguldak Barosu">Zonguldak Barosu</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lawyer-bar-number">Baro Numarası *</label>
                        <input type="text" id="lawyer-bar-number" required placeholder="Baro sicil numarası">
                    </div>
                    <div class="form-group">
                        <label for="lawyer-phone">Telefon</label>
                        <input type="tel" id="lawyer-phone" pattern="[0-9]{10,11}" placeholder="5XX XXX XX XX">
                    </div>
                    <div class="form-group full-width">
                        <label for="lawyer-address">Adres</label>
                        <textarea id="lawyer-address" rows="2" placeholder="Vekil adresi"></textarea>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer-advanced">
            <button type="button" class="btn btn-secondary" onclick="closeLawyerModal()">İptal</button>
            <button type="button" class="btn btn-primary" onclick="addLawyer()">Ekle</button>
        </div>
    </div>
</div>

<!-- UYAP Senkronizasyon Modal -->
<div class="modal" id="uyapSyncModal" tabindex="-1" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h5>UYAP Senkronizasyonu</h5>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <p>UYAP'a giriş yapmanız ve e-imzanızı kullanmanız gerekecektir. Bu işlem birkaç dakika sürebilir.</p>
            <div class="progress" style="display: none;">
                <div class="progress-bar"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary close-modal">İptal</button>
            <button type="button" class="btn" id="startSync">Senkronizasyonu Başlat</button>
        </div>
    </div>
</div>

<style>
:root {
    --primary-color: #1a237e;
    --hover-color: #0d1b6e;
    --section-bg: #f8f9fa;
    --border-color: #dee2e6;
    --text-color: #2c3e50;
    --success-color: #27ae60;
    --warning-color: #f39c12;
}

.container {
    max-width: 98%;
    margin: 0 auto;
    padding: 20px 40px;
    width: 98%;
    min-height: 100vh;
    box-sizing: border-box;
}

.case-form {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.main-sections {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 20px;
    margin-bottom: 30px;
    width: 100%;
}

.form-section {
    background: white;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    overflow: visible;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    min-height: 500px;
    height: auto;
    display: flex;
    flex-direction: column;
    position: relative;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
}

.section-header {
    background: var(--section-bg);
    padding: 18px 30px;
    border-bottom: 1px solid var(--border-color);
}

.section-header h3 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-color);
}

.section-header i {
    color: var(--primary-color);
    font-size: 22px;
}

.section-content {
    padding: 30px;
    flex: 1;
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    overflow: hidden;
}

.entity-type-selector {
    margin-bottom: 20px;
    padding: 16px;
    background: #f1f3f5;
    border-radius: 6px;
    border: 1px solid #e9ecef;
}

.radio-group {
    display: flex;
    gap: 20px;
}

.radio-option {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-weight: 500;
    color: var(--text-color);
}

.radio-option input[type="radio"] {
    width: 18px;
    height: 18px;
    accent-color: var(--primary-color);
}

.radio-label {
    font-size: 0.9rem;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 20px 30px;
    align-items: start;
    width: 100%;
    box-sizing: border-box;
}

/* Vekil form için 3 sütunlu grid */
.lawyer-form-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 15px 20px;
}

/* Numaralı mahkeme container'ı için özel grid stilı */
#court-number-container {
    display: none;
    grid-column: 1 / -1; /* Tam genişlik kapla */
    width: 100%;
    box-sizing: border-box;
}

#court-number-container.visible {
    display: flex;
    flex-direction: column;
    gap: 6px;
    width: 100%;
    box-sizing: border-box;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    min-width: 0; /* Prevent overflow */
}

.form-group.full-width {
    grid-column: 1 / -1;
    width: 100%;
    max-width: 100%;
}



.form-group label {
    font-weight: 600;
    color: var(--text-color);
    font-size: 0.9rem;
    margin-bottom: 6px;
}

.form-group input,
.form-group select,
.form-group textarea {
    padding: 14px 18px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 1rem;
    color: var(--text-color);
    background: white;
    transition: all 0.2s ease;
    font-family: inherit;
    min-height: 48px;
    box-sizing: border-box;
    width: 100%;
    max-width: 100%;
    min-width: 0;
}

.form-group select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 12px center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-right: 40px;
}

.form-group textarea {
    resize: vertical;
    min-height: 65px;
    line-height: 1.4;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
}

.form-group input:disabled,
.form-group select:disabled,
.form-group textarea:disabled {
    background-color: #f8f9fa;
    cursor: not-allowed;
    opacity: 0.7;
}

.form-actions {
    display: flex;
    justify-content: center;
    padding: 20px 0;
}

/* Modal için yeni stiller */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    padding: 20px;
    box-sizing: border-box;
}

.modal-content-small {
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-header {
    padding: 20px 25px;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8f9fa;
    border-radius: 12px 12px 0 0;
}

.modal-header h3 {
    margin: 0;
    font-size: 1.2rem;
    color: #2c3e50;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #6c757d;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    color: #dc3545;
}

.modal-body {
    padding: 25px;
}

.modal-footer {
    padding: 20px 25px;
    border-top: 1px solid #dee2e6;
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

/* Person Card Stili - Katlanabilir Özellik ile */
.person-card {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    margin-bottom: 12px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.person-card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.person-card-header {
    background: #f8f9fa;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #dee2e6;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.person-card-header:hover {
    background: #e9ecef;
}

.person-card-header.collapsed {
    border-bottom: none;
}

.person-name-section {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.collapse-indicator {
    color: #6c757d;
    font-size: 18px;
    transition: transform 0.3s ease;
}

.collapse-indicator.expanded {
    transform: rotate(90deg);
}

.person-name {
    font-weight: 600;
    color: #2c3e50;
    font-size: 1rem;
}

.person-summary {
    font-size: 0.85rem;
    color: #6c757d;
    margin-left: 8px;
}

.person-actions {
    display: flex;
    gap: 8px;
}

.btn-icon {
    background: none;
    border: none;
    cursor: pointer;
    padding: 6px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6c757d;
    transition: all 0.2s ease;
}

.btn-icon:hover {
    background: #e9ecef;
    color: #495057;
}

.btn-icon.btn-delete:hover {
    background: #f8d7da;
    color: #dc3545;
}

.person-card-details {
    padding: 15px 20px;
    border-top: 1px solid #f1f1f1;
    background: #fafbfc;
    max-height: 200px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.person-card-details.collapsed {
    max-height: 0;
    padding: 0 20px;
    opacity: 0;
}

.detail-row {
    display: flex;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.detail-row:last-child {
    margin-bottom: 0;
}

.detail-row span:first-child {
    font-weight: 600;
    color: #495057;
    min-width: 80px;
    margin-right: 10px;
}

.detail-row span:last-child {
    color: #6c757d;
    word-wrap: break-word;
    flex: 1;
}

/* Additional List Stili */
.additional-list {
    margin-top: 15px;
}

/* YENİ - Geliştirilmiş Modal Stilleri */
.modal-content-advanced {
    background: white;
    border-radius: 16px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    max-width: 600px;
    width: 95%;
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    margin: auto;
    position: relative;
}

.modal-header-advanced {
    background: linear-gradient(135deg, #1a237e 0%, #2d313c 100%);
    color: white;
    padding: 20px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header-simple {
    background: #f8f9fa;
    color: #2c3e50;
    padding: 18px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e9ecef;
}

.modal-title-section {
    display: flex;
    align-items: center;
    gap: 12px;
}

.modal-title-section i {
    font-size: 24px;
    color: inherit;
}

.modal-title-section h3 {
    margin: 0;
    font-size: 1.3rem;
    font-weight: 600;
    color: inherit;
}

.modal-close-advanced {
    background: rgba(108, 117, 125, 0.1);
    border: none;
    border-radius: 8px;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.modal-close-advanced:hover {
    background: rgba(108, 117, 125, 0.2);
}

.modal-close-advanced i {
    color: #6c757d;
    font-size: 20px;
}

.modal-body-advanced {
    padding: 25px;
    flex: 1;
    overflow-y: auto;
    background: #ffffff;
}

.person-form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.radio-group-advanced {
    display: flex;
    gap: 12px;
    margin-top: 6px;
}

.radio-option-advanced {
    display: flex;
    align-items: center;
    gap: 5px;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: background-color 0.2s ease;
}

.radio-option-advanced:hover {
    background: #f8f9fa;
}

.radio-option-advanced input[type="radio"] {
    width: 18px;
    height: 18px;
    accent-color: var(--primary-color);
}

.radio-label-advanced {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-color);
}

.modal-footer-advanced {
    padding: 20px 25px;
    border-top: 1px solid #e9ecef;
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    background: #f8f9fa;
}

/* YENİ - Geliştirilmiş Person Card Stilleri */
.person-card-new {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    margin-bottom: 16px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
}

.person-card-new:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    transform: translateY(-1px);
}

.person-card-header-new {
    background: #f8f9fa;
    padding: 16px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: background-color 0.2s ease;
    border-bottom: 1px solid #e9ecef;
}

.person-card-header-new:hover {
    background: #e9ecef;
}

.person-header-left {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.collapse-indicator-new {
    color: #6c757d;
    font-size: 20px;
    transition: all 0.3s ease;
}

.collapse-indicator-new.expanded {
    color: var(--primary-color);
}

.person-title-section {
    flex: 1;
}

.person-type-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: var(--primary-color);
    color: white;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 6px;
}

.person-type-badge i {
    font-size: 14px;
}

.person-name-new {
    font-weight: 600;
    color: #2c3e50;
    font-size: 1.05rem;
    margin-bottom: 4px;
}

.person-summary-new {
    font-size: 0.85rem;
    color: #6c757d;
    font-style: italic;
}

.person-actions-new {
    display: flex;
    gap: 8px;
    opacity: 0.7;
    transition: opacity 0.2s ease;
}

.person-card-new:hover .person-actions-new {
    opacity: 1;
}

.btn-icon-new {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    color: #6c757d;
}

.btn-icon-new:hover {
    background: #e9ecef;
    color: #495057;
}

.btn-icon-new.edit:hover {
    background: #e3f2fd;
    color: #1976d2;
}

.btn-icon-new.delete:hover {
    background: #ffebee;
    color: #d32f2f;
}

.btn-icon-new i {
    font-size: 18px;
}

.person-card-details-new {
    max-height: 0;
    overflow: hidden;
    background: #fafbfc;
    transition: all 0.3s ease;
    border-top: 1px solid #f1f1f1;
}

.person-card-details-new.open {
    max-height: 300px;
    padding: 20px;
}

.person-details-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.detail-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.detail-item.full-width {
    grid-column: 1 / -1;
}

.detail-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.detail-value {
    font-size: 0.9rem;
    color: #2c3e50;
    word-wrap: break-word;
    line-height: 1.4;
}

/* Bilgi Yok Mesajı */
.no-additional-info {
    text-align: center;
    color: #6c757d;
    font-style: italic;
    padding: 20px;
    margin: 0;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px dashed #dee2e6;
}

/* Success Toast */
.success-toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #2e7d32;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 10000;
    animation: slideInToast 0.3s ease-out;
}

.success-toast i {
    font-size: 20px;
}

.success-toast span {
    font-weight: 500;
}

@keyframes slideInToast {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Responsive iyileştirmeler */
@media (max-width: 768px) {
    .person-form-grid {
        grid-template-columns: 1fr;
    }
    
    .person-details-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-content-advanced {
        max-width: 95%;
        margin: 10px;
    }
    
    .person-header-left {
        gap: 8px;
    }
    
    .person-type-badge {
        font-size: 0.7rem;
        padding: 3px 8px;
    }
    
    .person-name-new {
        font-size: 1rem;
    }
}

.additional-section {
    padding: 20px 30px 30px;
    border-top: 1px solid #dee2e6;
    background: #f8f9fa;
}

.btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    min-height: 48px;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: var(--hover-color);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(26, 35, 126, 0.3);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

/* Modal Stilleri */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    position: relative;
    background-color: #fefefe;
    margin: 15% auto;
    padding: 0;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.modal-header {
    padding: 15px;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-body {
    padding: 15px;
}

.modal-footer {
    padding: 15px;
    border-top: 1px solid #dee2e6;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover {
    color: black;
}

.progress {
    width: 100%;
    height: 20px;
    background-color: #f0f0f0;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 10px;
}

.progress-bar {
    width: 100%;
    height: 100%;
    background-color: var(--primary-color);
    animation: progress-animation 2s linear infinite;
}

@keyframes progress-animation {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* Responsive Design */
@media (max-width: 1400px) {
    .container {
        max-width: 96%;
        width: 96%;
        padding: 20px 30px;
    }
}

@media (max-width: 1200px) {
    .main-sections {
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }
}

@media (max-width: 900px) {
    .form-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
}

@media (max-width: 768px) {
    .container {
        padding: 20px 15px;
        max-width: 100%;
    }
    
    .main-sections {
        grid-template-columns: 1fr;
        gap: 25px;
    }
    
    .section-content {
        padding: 20px;
    }
    
    .section-header {
        padding: 16px 20px;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .radio-group {
        flex-direction: column;
        gap: 10px;
    }
}

/* Bölüm devre dışı stilleri */
.form-section.disabled {
    opacity: 0.6;
    pointer-events: none;
}

.form-section.disabled .section-header {
    background: #f1f1f1;
}

/* Ek müvekkil/karşı taraf stilleri */
.additional-section {
    padding: 15px 30px 30px 30px;
    border-top: 1px solid var(--border-color);
    background: #fafbfc;
}

.additional-list {
    margin-top: 15px;
}

.additional-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    margin-bottom: 8px;
    background: white;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.additional-item-info {
    flex: 1;
    font-size: 0.95rem;
    color: var(--text-color);
}

.additional-item-name {
    font-weight: 600;
    color: var(--primary-color);
}

.additional-item-id {
    font-size: 0.85rem;
    color: #666;
    margin-left: 8px;
}

.btn-delete {
    background: #dc3545;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: background-color 0.2s;
}

.btn-delete:hover {
    background: #c82333;
}

.btn-delete i {
    font-size: 16px;
}

.additional-section {
    padding: 20px 30px;
    border-top: 1px solid var(--border-color);
    background: #f8f9fa;
}

.additional-list {
    margin-top: 15px;
}
</style>

<script>
// Backend'den gelen tüm adliye verisi
const allCourthousesData = JSON.parse('{{ all_courthouses | safe }}');

// Dosya türüne göre sıfat seçenekleri
const capacityOptions = {
    hukuk: {
        client: ['Davacı', 'Davalı', 'Davalı-Karşı Davacı', 'Davacı Karşı Davalı', 'Talepte Bulunan', 'Muris', 'Kayyım', 'Dahili Davalı', 'Kısıtlı', 'Temsilci', 'Mirasçı'],
        opponent: ['Davalı', 'Davacı', 'Davalı-Karşı Davacı', 'Davacı Karşı Davalı', 'Talepte Bulunan', 'Muris', 'Kayyım', 'Dahili Davalı', 'Kısıtlı', 'Temsilci', 'Mirasçı']
    },
    ceza: {
        client: ['Mağdur', 'Müşteki', 'Sanık', 'Katılan', 'S.S.Ç.'],
        opponent: ['Mağdur', 'Müşteki', 'Sanık', 'Katılan', 'S.S.Ç.']
    },
    savcilik: {
        client: ['Mağdur', 'Müşteki', 'Sanık', 'Katılan', 'S.S.Ç.'],
        opponent: ['Mağdur', 'Müşteki', 'Sanık', 'Katılan', 'S.S.Ç.']
    },
    icra: {
        client: ['Alacaklı', 'Borçlu'],
        opponent: ['Alacaklı', 'Borçlu']
    },
    ARABULUCULUK: {
        client: ['Başvuran', 'Aleyhine Başvurulan'],
        opponent: ['Başvuran', 'Aleyhine Başvurulan']
    },
    AİHM: {
        client: ['Başvurucu'],
        opponent: []
    },
    AYM: {
        client: ['Başvurucu'],
        opponent: []
    }
};

// İstanbul'a özel adliyeler
const istanbulSpecificCourthouses = [
    "İstanbul Anadolu Adliyesi (Kartal)",
    "İstanbul Adliyesi (Çağlayan)",
    "Bakırköy Adliyesi",
    "Büyükçekmece Adliyesi",
    "Gaziosmanpaşa Adliyesi",
    "Küçükçekmece Adliyesi",
    "Silivri Adliyesi",
    "Çatalca Adliyesi",
    "Üsküdar Adliyesi",
    "Adalar Adliyesi",
    "Sarıyer Adliyesi",
    "Şile Adliyesi"
];

document.addEventListener('DOMContentLoaded', () => {
    setupDepartmentOptions();
    handleFileTypeChange();
    setupModalEvents();
    setupFormSubmit();
    setupAdditionalPeople();
    setupFileTypeChangeListener();
    setupLawyerModal();
});

// Vekil bilgilerini göster/gizle
function toggleOpponentLawyer() {
    const lawyerSection = document.getElementById('opponent-lawyer-section');
    const btnText = document.getElementById('lawyer-btn-text');
    
    if (lawyerSection.style.display === 'none') {
        lawyerSection.style.display = 'block';
        btnText.textContent = 'Vekil Gizle';
    } else {
        lawyerSection.style.display = 'none';
        btnText.textContent = 'Vekil Ekle';
        // Alanları temizle
        document.getElementById('opponent-lawyer').value = '';
        document.getElementById('opponent-lawyer-phone').value = '';
        document.getElementById('opponent-lawyer-address').value = '';
    }
}

// Dosya türü değişim dinleyicisi
function setupFileTypeChangeListener() {
    const fileTypeSelect = document.getElementById('file-type');
    fileTypeSelect.addEventListener('change', handleFileTypeChange);
}

function setupDepartmentOptions() {
    const departmentSelect = document.getElementById('department');
    const allDepartments = [
        'Asliye Hukuk Mahkemesi', 'Sulh Hukuk Mahkemesi', 'İş Mahkemesi', 'Aile Mahkemesi',
        'Ticaret Mahkemesi', 'İcra Hukuk Mahkemesi', 'Tüketici Mahkemesi', 'Fikri ve Sınai Haklar Mahkemesi',
        'Asliye Ceza Mahkemesi', 'Ağır Ceza Mahkemesi', 'Sulh Ceza Hakimliği', 'İcra Dairesi'
    ];
    
    allDepartments.forEach(dept => {
        const option = document.createElement('option');
        option.value = dept;
        option.textContent = dept;
        departmentSelect.appendChild(option);
    });
}

function handleFileTypeChange() {
    const fileType = document.getElementById('file-type').value;
    const opponentSection = document.getElementById('opponent-section');
    const citySelect = document.getElementById('city');
    const courthouseSelect = document.getElementById('courthouse');
    const departmentSelect = document.getElementById('department');
    const courtNumberContainer = document.getElementById('court-number-container');
    
    // Numaralı mahkeme container'ını başlangıçta gizle
    courtNumberContainer.classList.remove('visible');
    
    // Karşı taraf bölümünü kontrol et
    if (['AİHM', 'AYM'].includes(fileType)) {
        opponentSection.classList.add('disabled');
        disableOpponentFields();
    } else {
        opponentSection.classList.remove('disabled');
        enableOpponentFields();
    }
    
    // Adliye ve mahkeme alanlarını kontrol et
    const shouldDisableCourthouse = ['ARABULUCULUK', 'AİHM', 'AYM'].includes(fileType);
    const shouldDisableDepartment = ['ARABULUCULUK', 'AİHM', 'AYM', 'savcilik'].includes(fileType);
    
    citySelect.disabled = shouldDisableCourthouse;
    courthouseSelect.disabled = shouldDisableCourthouse;
    departmentSelect.disabled = shouldDisableDepartment;
    
    citySelect.required = !shouldDisableCourthouse;
    courthouseSelect.required = !shouldDisableCourthouse;
    departmentSelect.required = !shouldDisableDepartment;
    
    // Sıfat seçeneklerini güncelle
    updateCapacityOptions();
    updateDepartmentOptions();
}

function updateCapacityOptions() {
    const fileType = document.getElementById('file-type').value;
    const clientCapacity = document.getElementById('client-capacity');
    const opponentCapacity = document.getElementById('opponent-capacity');
    
    // Müvekkil sıfatı seçenekleri
    clientCapacity.innerHTML = '<option value="">Seçiniz</option>';
    if (capacityOptions[fileType] && capacityOptions[fileType].client) {
        capacityOptions[fileType].client.forEach(capacity => {
            const option = document.createElement('option');
            option.value = capacity;
            option.textContent = capacity;
            clientCapacity.appendChild(option);
        });
    }
    
    // Karşı taraf sıfatı seçenekleri
    opponentCapacity.innerHTML = '<option value="">Seçiniz</option>';
    if (capacityOptions[fileType] && capacityOptions[fileType].opponent && capacityOptions[fileType].opponent.length > 0) {
        capacityOptions[fileType].opponent.forEach(capacity => {
            const option = document.createElement('option');
            option.value = capacity;
            option.textContent = capacity;
            opponentCapacity.appendChild(option);
        });
        opponentCapacity.disabled = false;
    } else {
        opponentCapacity.disabled = true;
    }
}

function updateDepartmentOptions() {
    const fileType = document.getElementById('file-type').value.toLowerCase();
    const departmentSelect = document.getElementById('department');
    
    // Mevcut seçenekleri temizle (Seçiniz hariç)
    while (departmentSelect.options.length > 1) {
        departmentSelect.remove(1);
    }
    
    let departments = [];
    if (fileType === 'hukuk') {
        departments = [
            'Asliye Hukuk Mahkemesi', 'Sulh Hukuk Mahkemesi', 'İş Mahkemesi', 'Aile Mahkemesi',
            'Ticaret Mahkemesi', 'İcra Hukuk Mahkemesi', 'Tüketici Mahkemesi', 'Fikri ve Sınai Haklar Mahkemesi'
        ];
    } else if (fileType === 'ceza') {
        departments = ['Asliye Ceza Mahkemesi', 'Ağır Ceza Mahkemesi', 'Sulh Ceza Hakimliği'];
    } else if (fileType === 'icra') {
        departments = ['İcra Dairesi'];
    }
    
    departments.forEach(dept => {
        const option = document.createElement('option');
        option.value = dept;
        option.textContent = dept;
        departmentSelect.appendChild(option);
    });
    
    // Departman seçimi değiştiğinde numaralı mahkeme seçeneğini güncelle
    departmentSelect.onchange = function() {
        updateCourtNumbers(this.value);
    };
}

function updateCourtNumbers(department) {
    const courtNumberContainer = document.getElementById('court-number-container');
    const courtNumberSelect = document.getElementById('court-number');
    
    // Mahkeme numaralarını temizle
    courtNumberSelect.innerHTML = '<option value="">Seçiniz</option>';
    
    // İcra Dairesi zaten numaralı olduğu için dışarıda bırak
    if (!department || department === '') {
        courtNumberContainer.classList.remove('visible');
        return;
    }
    
    // Özel durumlar için numaralı mahkeme seçeneğini gizle
    if (['ARABULUCULUK', 'AİHM', 'AYM', 'savcilik'].includes(document.getElementById('file-type').value)) {
        courtNumberContainer.classList.remove('visible');
        return;
    }
    
    // Adliye ve şehre göre mahkeme sayısını belirle
    const citySelect = document.getElementById('city');
    const courthouseSelect = document.getElementById('courthouse');
    const selectedCity = citySelect.value;
    const selectedCourthouse = courthouseSelect.value;
    
    // Tüm şehirler ve adliyeler için 70'e kadar mahkeme seçeneği
    let maxCourtNumber = 70; // 30'dan 70'e çıkarıldı - artık tüm lokasyonlar için geçerli
    
    if (department === 'İcra Dairesi') {
        // İcra daireleri için özel numaralandırma
        for (let i = 1; i <= maxCourtNumber; i++) {
            const option = document.createElement('option');
            option.value = `${i}. ${department}`;
            option.textContent = `${i}. ${department}`;
            courtNumberSelect.appendChild(option);
        }
    } else {
        // Temel mahkeme adını da bir seçenek olarak ekle (Numarasız hali)
        const baseOption = document.createElement('option');
        baseOption.value = department;
        baseOption.textContent = department;
        courtNumberSelect.appendChild(baseOption);
        
        // Numaralı mahkemeleri ekle
        for (let i = 1; i <= maxCourtNumber; i++) {
            const option = document.createElement('option');
            option.value = `${i}. ${department}`;
            option.textContent = `${i}. ${department}`;
            courtNumberSelect.appendChild(option);
        }
    }
    
    courtNumberContainer.classList.add('visible');
}

function toggleClientEntityType() {
    const entityType = document.querySelector('input[name="client-entity-type"]:checked').value;
    const nameLabel = document.getElementById('client-name-label');
    const idLabel = document.getElementById('client-id-label');
    const idInput = document.getElementById('client-id');
    
    if (entityType === 'company') {
        nameLabel.textContent = 'Kurum Unvanı *';
        idLabel.textContent = 'Vergi/Mersis/Ticaret Sicil No';
        idInput.maxLength = 20;
    } else {
        nameLabel.textContent = 'Ad Soyad *';
        idLabel.textContent = 'T.C. Kimlik No';
        idInput.maxLength = 11;
    }
}

function toggleOpponentEntityType() {
    const entityType = document.querySelector('input[name="opponent-entity-type"]:checked').value;
    const nameLabel = document.getElementById('opponent-name-label');
    const idLabel = document.getElementById('opponent-id-label');
    const idInput = document.getElementById('opponent-id');
    
    if (entityType === 'company') {
        nameLabel.textContent = 'Kurum Unvanı';
        idLabel.textContent = 'Vergi/Mersis/Ticaret Sicil No';
        idInput.maxLength = 20;
    } else {
        nameLabel.textContent = 'Ad Soyad';
        idLabel.textContent = 'T.C. Kimlik No';
        idInput.maxLength = 11;
    }
}

function disableOpponentFields() {
    const opponentFields = document.querySelectorAll('#opponent-section input, #opponent-section select, #opponent-section textarea');
    opponentFields.forEach(field => field.disabled = true);
}

function enableOpponentFields() {
    const opponentFields = document.querySelectorAll('#opponent-section input, #opponent-section select, #opponent-section textarea');
    opponentFields.forEach(field => field.disabled = false);
}

function updateCourthouses() {
    const citySelect = document.getElementById('city');
    const courthouseSelect = document.getElementById('courthouse');
    const selectedCity = citySelect.value;

    courthouseSelect.innerHTML = '<option value="">Seçiniz</option>';

    if (!selectedCity) {
        courthouseSelect.innerHTML = '<option value="">Önce Şehir Seçiniz</option>';
        return;
    }

    let courthousesAdded = false;

    if (selectedCity === 'İstanbul') {
        istanbulSpecificCourthouses.forEach(courthouse => {
            const option = document.createElement('option');
            option.value = courthouse;
            option.textContent = courthouse;
            courthouseSelect.appendChild(option);
        });
        courthousesAdded = true;
    }
    
    if (selectedCity && allCourthousesData && allCourthousesData[selectedCity]) {
        allCourthousesData[selectedCity].forEach(courthouse => {
            if (selectedCity === 'İstanbul' && istanbulSpecificCourthouses.includes(courthouse)) {
                return;
            }
            const option = document.createElement('option');
            option.value = courthouse;
            option.textContent = courthouse;
            courthouseSelect.appendChild(option);
        });
        courthousesAdded = true;
    }

    if (!courthousesAdded || courthouseSelect.options.length <= 1) {
        courthouseSelect.innerHTML = '<option value="">Bu şehir için adliye bulunamadı</option>';
    }
}

function setupModalEvents() {
    const modal = document.getElementById('uyapSyncModal');
    const btn = document.getElementById('uyapSyncBtn');
    const span = document.getElementsByClassName('close')[0];
    const cancelBtn = modal.querySelector('.close-modal');
    const startSyncBtn = document.getElementById('startSync');
    const progressBar = modal.querySelector('.progress');

    if (btn) {
        btn.onclick = () => {
            alert('Bu özellik yakında kullanıma sunulacaktır. Lütfen daha sonra tekrar deneyin.');
        };
    }
    if (span) {
        span.onclick = () => modal.style.display = 'none';
    }
    if (cancelBtn) {
        cancelBtn.onclick = () => modal.style.display = 'none';
    }
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
    if(startSyncBtn){
        startSyncBtn.onclick = function() {
            progressBar.style.display = 'block';
            console.log("UYAP senkronizasyonu başlatıldı...");
        }
    }
}

// Ek kişiler için global diziler - SIFIRDAN YENİDEN YAZILDI
let additionalClients = [];
let additionalOpponents = [];

function setupFormSubmit() {
    const form = document.getElementById('addCaseForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            // Ek kişileri JSON formatında hidden input'lara ekle
            addAdditionalPeopleToForm();
        });
    }
}

function setupAdditionalPeople() {
    const addClientBtn = document.getElementById('addClientBtn');
    const addOpponentBtn = document.getElementById('addOpponentBtn');
    
    if (addClientBtn) {
        addClientBtn.addEventListener('click', () => showNewPersonModal('client'));
    }
    
    if (addOpponentBtn) {
        addOpponentBtn.addEventListener('click', () => showNewPersonModal('opponent'));
    }
}

// YENİ - Geliştirilmiş person modal
function showNewPersonModal(type) {
    const isClient = type === 'client';
            const title = isClient ? 'Müvekkil Ekle' : 'Karşı Taraf Ekle';
    const titleIcon = isClient ? 'person_add' : 'group_add';
    
    const modalHtml = `
        <div class="modal-overlay" id="newPersonModal">
            <div class="modal-content-advanced">
                <div class="modal-header-simple">
                    <div class="modal-title-section">
                        <i class="material-icons">${titleIcon}</i>
                        <h3>${title}</h3>
                    </div>
                    <button type="button" class="modal-close-advanced" onclick="closeNewPersonModal()">
                        <i class="material-icons">close</i>
                    </button>
                </div>
                <div class="modal-body-advanced">
                    <form id="newPersonForm">
                        <div class="person-form-grid">
                            <div class="form-group">
                                <label for="add-entity-type">Tür *</label>
                                <select id="add-entity-type" name="add-entity-type" onchange="updatePersonModalLabels()" required>
                                    <option value="person">Kişi</option>
                                    <option value="company">Kurum</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="add-capacity">Sıfat</label>
                                <select id="add-capacity">
                                    <option value="">Seçiniz</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label for="add-name" id="add-name-label">Ad Soyad *</label>
                                <input type="text" id="add-name" required placeholder="Kişinin ad soyadını girin">
                            </div>
                            <div class="form-group">
                                <label for="add-phone">Telefon</label>
                                <input type="tel" id="add-phone" placeholder="5XX XXX XX XX">
                            </div>
                            <div class="form-group">
                                <label for="add-identity" id="add-identity-label">T.C. Kimlik No</label>
                                <input type="text" id="add-identity" maxlength="11" placeholder="12345678901">
                            </div>
                            <div class="form-group full-width">
                                <label for="add-address">Adres</label>
                                <textarea id="add-address" rows="2" placeholder="Tam adres bilgisi"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer-advanced">
                    <button type="button" class="btn btn-secondary" onclick="closeNewPersonModal()">İptal</button>
                    <button type="button" class="btn btn-primary" onclick="addNewPersonToList('${type}')">
                        <i class="material-icons">add</i>
                        Ekle
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Entity type değişimi için event listener
    const entityTypeSelect = document.getElementById('add-entity-type');
    if (entityTypeSelect) {
        entityTypeSelect.addEventListener('change', updatePersonModalLabels);
    }
    
    // Sıfat dropdown'ını güncelle
    updateModalCapacityOptions(type);
}

function updatePersonModalLabels() {
    const entityType = document.getElementById('add-entity-type').value;
    const nameLabel = document.getElementById('add-name-label');
    const identityLabel = document.getElementById('add-identity-label');
    const nameInput = document.getElementById('add-name');
    const identityInput = document.getElementById('add-identity');
    
    switch(entityType) {
        case 'person':
            nameLabel.textContent = 'Ad Soyad *';
            identityLabel.textContent = 'T.C. Kimlik No';
            nameInput.placeholder = 'Kişinin ad soyadını girin';
            identityInput.placeholder = '12345678901';
            identityInput.maxLength = 11;
            break;
        case 'company':
            nameLabel.textContent = 'Kurum Unvanı *';
            identityLabel.textContent = 'Vergi/Mersis/Ticaret Sicil No';
            nameInput.placeholder = 'Kurum unvanını girin';
            identityInput.placeholder = '1234567890';
            identityInput.maxLength = 20;
            break;
        default:
            nameLabel.textContent = 'Ad Soyad *';
            identityLabel.textContent = 'T.C. Kimlik No';
            nameInput.placeholder = 'Kişinin ad soyadını girin';
            identityInput.placeholder = '12345678901';
            identityInput.maxLength = 11;
    }
}

function updateModalCapacityOptions(personType) {
    const fileType = document.getElementById('file-type').value;
    const capacitySelect = document.getElementById('add-capacity');
    
    capacitySelect.innerHTML = '<option value="">Seçiniz</option>';
    
    if (capacityOptions[fileType]) {
        const optionsKey = personType === 'client' ? 'client' : 'opponent';
        const options = capacityOptions[fileType][optionsKey];
        
        if (options && options.length > 0) {
            options.forEach(capacity => {
                const option = document.createElement('option');
                option.value = capacity;
                option.textContent = capacity;
                capacitySelect.appendChild(option);
            });
        }
    }
}

function closeNewPersonModal() {
    const modal = document.getElementById('newPersonModal');
    if (modal) {
        modal.remove();
    }
}

function addNewPersonToList(type) {
    const name = document.getElementById('add-name').value.trim();
    const capacity = document.getElementById('add-capacity').value.trim();
    const identity = document.getElementById('add-identity').value.trim();
    const phone = document.getElementById('add-phone').value.trim();
    const address = document.getElementById('add-address').value.trim();
    const entityType = document.getElementById('add-entity-type').value;
    
    // Validasyon
    if (!name) {
        alert('Ad Soyad/Kurum Unvanı alanı zorunludur!');
        return;
    }
    
    // T.C. kimlik no validasyonu (eğer girilmişse)
    if (identity && entityType === 'person' && identity.length !== 11) {
        alert('T.C. Kimlik No 11 haneli olmalıdır!');
        return;
    }
    
    const person = {
        id: Date.now() + Math.random(), // Daha unique ID
        entity_type: entityType, // Backend ile uyumlu
        name: name,
        capacity: capacity,
        identity_number: identity, // Backend ile uyumlu
        phone: phone,
        address: address
    };
    
    if (type === 'client') {
        additionalClients.push(person);
        renderNewAdditionalClients();
    } else {
        additionalOpponents.push(person);
        renderNewAdditionalOpponents();
    }
    
    closeNewPersonModal();
    
    // Başarı mesajı
    const message = type === 'client' ? 'Ek müvekkil başarıyla eklendi!' : 'Ek karşı taraf başarıyla eklendi!';
    showSuccessMessage(message);
}

function renderNewAdditionalClients() {
    const container = document.getElementById('additionalClients');
    container.innerHTML = '';
    
    if (additionalClients.length === 0) {
        container.innerHTML = '<p class="no-additional-info">Henüz ek müvekkil eklenmemiş.</p>';
        return;
    }
    
    additionalClients.forEach((client, index) => {
        const card = createNewPersonCard(client, 'client', index);
        container.appendChild(card);
    });
}

function renderNewAdditionalOpponents() {
    const container = document.getElementById('additionalOpponents');
    container.innerHTML = '';
    
    if (additionalOpponents.length === 0) {
        container.innerHTML = '<p class="no-additional-info">Henüz ek karşı taraf eklenmemiş.</p>';
        return;
    }
    
    additionalOpponents.forEach((opponent, index) => {
        const card = createNewPersonCard(opponent, 'opponent', index);
        container.appendChild(card);
    });
}

// YENİ - Geliştirilmiş person card
function createNewPersonCard(person, type, index) {
    const div = document.createElement('div');
    div.className = 'person-card-new';
    div.setAttribute('data-person-id', person.id);
    
    const entityLabels = {
        'person': 'Gerçek Kişi',
        'company': 'Şirket',
        'public': 'Kamu Kurumu',
        'legal_entity': 'Tüzel Kişi'
    };
    const entityLabel = entityLabels[person.entity_type] || 'Gerçek Kişi';
    const idLabels = {
        'person': 'T.C. Kimlik No',
        'company': 'Vergi/Mersis/Ticaret Sicil No',
        'public': 'Vergi/Kurum No',
        'legal_entity': 'Vergi/Sicil No'
    };
    const idLabel = idLabels[person.entity_type] || 'T.C. Kimlik No';
    const typeLabel = type === 'client' ? 'Ek Müvekkil' : 'Ek Karşı Taraf';
    const typeIcon = type === 'client' ? 'person_add' : 'group_add';
    
    // Özet bilgi oluştur
    const summaryParts = [];
    if (person.capacity) summaryParts.push(person.capacity);
    if (person.identity_number) summaryParts.push(person.identity_number);
    const summary = summaryParts.length > 0 ? summaryParts.join(' • ') : 'Bilgi yok';
    
    div.innerHTML = `
        <div class="person-card-header-new" onclick="toggleNewPersonCard('${person.id}')">
            <div class="person-header-left">
                <i class="material-icons collapse-indicator-new expanded" id="indicator-${person.id}">expand_more</i>
                <div class="person-title-section">
                    <div class="person-type-badge">
                        <i class="material-icons">${typeIcon}</i>
                        ${typeLabel} ${index + 1}
        </div>
                    <div class="person-name-new">${person.name}</div>
                    <div class="person-summary-new">${summary}</div>
                </div>
            </div>
            <div class="person-actions-new" onclick="event.stopPropagation()">
                <button type="button" class="btn-icon-new edit" onclick="editNewPerson('${person.id}', '${type}')" title="Düzenle">
                    <i class="material-icons">edit</i>
                </button>
                <button type="button" class="btn-icon-new delete" onclick="removeNewPerson('${person.id}', '${type}')" title="Sil">
            <i class="material-icons">delete</i>
        </button>
            </div>
        </div>
        <div class="person-card-details-new" id="details-${person.id}">
            <div class="person-details-grid">
                <div class="detail-item">
                    <span class="detail-label">Tür:</span>
                    <span class="detail-value">${entityLabel}</span>
                </div>
                ${person.capacity ? `
                <div class="detail-item">
                    <span class="detail-label">Sıfat:</span>
                    <span class="detail-value">${person.capacity}</span>
                </div>` : ''}
                ${person.identity_number ? `
                <div class="detail-item">
                    <span class="detail-label">${idLabel}:</span>
                    <span class="detail-value">${person.identity_number}</span>
                </div>` : ''}
                ${person.phone ? `
                <div class="detail-item">
                    <span class="detail-label">Telefon:</span>
                    <span class="detail-value">${person.phone}</span>
                </div>` : ''}
                ${person.address ? `
                <div class="detail-item full-width">
                    <span class="detail-label">Adres:</span>
                    <span class="detail-value">${person.address}</span>
                </div>` : ''}
            </div>
        </div>
    `;
    
    return div;
}

// YENİ - Kişi kartını aç/kapat
function toggleNewPersonCard(personId) {
    const details = document.getElementById(`details-${personId}`);
    const indicator = document.getElementById(`indicator-${personId}`);
    
    if (details && indicator) {
        const isOpen = details.classList.contains('open');
        
        if (isOpen) {
            details.classList.remove('open');
            indicator.textContent = 'expand_more';
            indicator.classList.remove('expanded');
        } else {
            details.classList.add('open');
            indicator.textContent = 'expand_less';
            indicator.classList.add('expanded');
        }
    }
}

function editNewPerson(personId, type) {
    let person;
    if (type === 'client') {
        person = additionalClients.find(c => c.id == personId);
    } else {
        person = additionalOpponents.find(o => o.id == personId);
    }
    
    if (!person) return;
    
    showNewPersonModal(type);
    
    // Modal yüklendikten sonra değerleri doldur
    setTimeout(() => {
        document.getElementById('add-name').value = person.name;
        document.getElementById('add-capacity').value = person.capacity || '';
        document.getElementById('add-identity').value = person.identity_number || '';
        document.getElementById('add-phone').value = person.phone || '';
        document.getElementById('add-address').value = person.address || '';
        document.getElementById('add-entity-type').value = person.entity_type;
        
        // Label'ları güncelle
        updatePersonModalLabels();
        
        // Modal başlığını güncelle
        const titleSection = document.querySelector('#newPersonModal .modal-title-section h3');
        if (titleSection) {
            titleSection.textContent = type === 'client' ? 'Müvekkil Düzenle' : 'Karşı Taraf Düzenle';
        }
        
        // Ekle butonunu güncelle butonuna çevir
        const addBtn = document.querySelector('#newPersonModal .btn-primary');
        if (addBtn) {
            addBtn.innerHTML = '<i class="material-icons">save</i> Güncelle';
            addBtn.onclick = () => updateNewPersonInList(personId, type);
        }
    }, 100);
}

function updateNewPersonInList(personId, type) {
    const name = document.getElementById('add-name').value.trim();
    const capacity = document.getElementById('add-capacity').value.trim();
    const identity = document.getElementById('add-identity').value.trim();
    const phone = document.getElementById('add-phone').value.trim();
    const address = document.getElementById('add-address').value.trim();
    const entityType = document.getElementById('add-entity-type').value;
    
    if (!name) {
        alert('Ad Soyad/Kurum Unvanı alanı zorunludur!');
        return;
    }
    
    // T.C. kimlik no validasyonu
    if (identity && entityType === 'person' && identity.length !== 11) {
        alert('T.C. Kimlik No 11 haneli olmalıdır!');
        return;
    }
    
    const updatedPerson = {
        id: personId,
        entity_type: entityType,
        name: name,
        capacity: capacity,
        identity_number: identity,
        phone: phone,
        address: address
    };
    
    if (type === 'client') {
        const index = additionalClients.findIndex(c => c.id == personId);
        if (index !== -1) {
            additionalClients[index] = updatedPerson;
            renderNewAdditionalClients();
        }
    } else {
        const index = additionalOpponents.findIndex(o => o.id == personId);
        if (index !== -1) {
            additionalOpponents[index] = updatedPerson;
            renderNewAdditionalOpponents();
        }
    }
    
    closeNewPersonModal();
    showSuccessMessage('Bilgiler başarıyla güncellendi!');
}

function removeNewPerson(personId, type) {
    const personName = type === 'client' 
        ? additionalClients.find(c => c.id == personId)?.name
        : additionalOpponents.find(o => o.id == personId)?.name;
    
    if (confirm(`"${personName}" isimli kişiyi silmek istediğinizden emin misiniz?`)) {
        if (type === 'client') {
            additionalClients = additionalClients.filter(client => client.id != personId);
            renderNewAdditionalClients();
        } else {
            additionalOpponents = additionalOpponents.filter(opponent => opponent.id != personId);
            renderNewAdditionalOpponents();
        }
        
        showSuccessMessage('Kişi başarıyla silindi!');
    }
}

function addAdditionalPeopleToForm() {
    // Mevcut hidden input'ları temizle
    const existingInputs = document.querySelectorAll('input[name^="additional_"]');
    existingInputs.forEach(input => input.remove());
    
    // Ek kişileri JSON formatında ekle
    if (additionalClients.length > 0) {
        addHiddenInput('additional_clients_json', JSON.stringify(additionalClients));
    }
    
    if (additionalOpponents.length > 0) {
        addHiddenInput('additional_opponents_json', JSON.stringify(additionalOpponents));
    }
}

function addHiddenInput(name, value) {
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = name;
    input.value = value || '';
    document.getElementById('addCaseForm').appendChild(input);
}

// Yardımcı fonksiyonlar
function showSuccessMessage(message) {
    // Geçici başarı mesajı göster
    const toast = document.createElement('div');
    toast.className = 'success-toast';
    toast.innerHTML = `
        <i class="material-icons">check_circle</i>
        <span>${message}</span>
    `;
    
    document.body.appendChild(toast);
    
    // 3 saniye sonra kaldır
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// Vekil modal için setup
function setupLawyerModal() {
    const addLawyerBtn = document.getElementById('addLawyerBtn');
    if (addLawyerBtn) {
        addLawyerBtn.addEventListener('click', showLawyerModal);
    }
}

function showLawyerModal() {
    const modal = document.getElementById('lawyerModal');
    if (modal) {
        modal.style.display = 'block';
    }
}

function closeLawyerModal() {
    const modal = document.getElementById('lawyerModal');
    if (modal) {
        modal.style.display = 'none';
        // Form'u temizle
        document.getElementById('lawyerForm').reset();
    }
}

function addLawyer() {
    const name = document.getElementById('lawyer-name').value.trim();
    const bar = document.getElementById('lawyer-bar').value.trim();
    const barNumber = document.getElementById('lawyer-bar-number').value.trim();
    const phone = document.getElementById('lawyer-phone').value.trim();
    const address = document.getElementById('lawyer-address').value.trim();

    // Validasyon
    if (!name) {
        alert('Vekil adı soyadı zorunludur!');
        return;
    }

    if (!barNumber) {
        alert('Baro numarası zorunludur!');
        return;
    }

    // Vekil bilgilerini ana forma ekle (baro bilgisi de dahil)
    document.getElementById('opponent-lawyer').value = name;
    document.getElementById('opponent-lawyer-bar-number').value = barNumber;
    document.getElementById('opponent-lawyer-phone').value = phone;
    document.getElementById('opponent-lawyer-address').value = address;

    // Baro bilgisini de bir hidden input olarak ekle
    addHiddenInput('opponent-lawyer-bar', bar);
    
    // Vekil kartını oluştur ve göster
    const lawyerContainer = document.getElementById('lawyer-display');
    if (lawyerContainer) {
        const lawyerCard = createLawyerCard(name, bar, barNumber, phone, address);
        lawyerContainer.innerHTML = '';
        lawyerContainer.appendChild(lawyerCard);
        lawyerContainer.style.display = 'block';
        
        // Vekil ekleme butonunu gizle
        const addBtn = document.querySelector('[onclick="showLawyerModal()"]');
        if (addBtn) {
            addBtn.style.display = 'none';
        }
    }
    
    // Modalı kapat
    closeLawyerModal();
    
    // Başarı mesajı
    showSuccessMessage('Vekil bilgileri başarıyla eklendi!');
}

function createLawyerCard(name, bar, barNumber, phone, address) {
    const div = document.createElement('div');
    div.className = 'person-card-new';
    div.setAttribute('data-lawyer', 'true');

    // Özet bilgi oluştur
    const summaryParts = [];
    if (bar) summaryParts.push(bar);
    if (barNumber) summaryParts.push(`Sicil: ${barNumber}`);
    if (phone) summaryParts.push(phone);
    const summary = summaryParts.length > 0 ? summaryParts.join(' • ') : 'Bilgi girilmedi';
    
    div.innerHTML = `
        <div class="person-card-header-new" onclick="toggleLawyerCard()">
            <div class="person-header-left">
                <i class="material-icons collapse-indicator-new expanded" id="lawyer-indicator">expand_more</i>
                <div class="person-title-section">
                    <div class="person-type-badge">
                        <i class="material-icons">account_balance</i>
                        Vekil
                    </div>
                    <div class="person-name-new">${name}</div>
                    <div class="person-summary-new">${summary}</div>
                </div>
            </div>
            <div class="person-actions-new" onclick="event.stopPropagation()">
                <button type="button" class="btn-icon-new edit" onclick="editLawyer()" title="Düzenle">
                    <i class="material-icons">edit</i>
                </button>
                <button type="button" class="btn-icon-new delete" onclick="removeLawyer()" title="Sil">
                    <i class="material-icons">delete</i>
                </button>
            </div>
        </div>
        <div class="person-card-details-new" id="lawyer-details">
            <div class="person-details-grid">
                ${bar ? `
                <div class="detail-item">
                    <span class="detail-label">Baro:</span>
                    <span class="detail-value">${bar}</span>
                </div>` : ''}
                <div class="detail-item">
                    <span class="detail-label">Baro Numarası:</span>
                    <span class="detail-value">${barNumber}</span>
                </div>
                ${phone ? `
                <div class="detail-item">
                    <span class="detail-label">Telefon:</span>
                    <span class="detail-value">${phone}</span>
                </div>` : ''}
                ${address ? `
                <div class="detail-item full-width">
                    <span class="detail-label">Adres:</span>
                    <span class="detail-value">${address}</span>
                </div>` : ''}
            </div>
        </div>
    `;
    
    return div;
}

function toggleLawyerCard() {
    const details = document.getElementById('lawyer-details');
    const indicator = document.getElementById('lawyer-indicator');
    
    if (details && indicator) {
        const isOpen = details.classList.contains('open');
        
        if (isOpen) {
            details.classList.remove('open');
            indicator.textContent = 'expand_more';
            indicator.classList.remove('expanded');
        } else {
            details.classList.add('open');
            indicator.textContent = 'expand_less';
            indicator.classList.add('expanded');
        }
    }
}

function editLawyer() {
    // Mevcut değerleri al
    const name = document.getElementById('opponent-lawyer').value;
    const barNumber = document.getElementById('opponent-lawyer-bar-number').value;
    const phone = document.getElementById('opponent-lawyer-phone').value;
    const address = document.getElementById('opponent-lawyer-address').value;

    // Baro bilgisini hidden input'tan al
    const barInput = document.querySelector('input[name="opponent-lawyer-bar"]');
    const bar = barInput ? barInput.value : '';

    // Modalı aç ve değerleri doldur
    showLawyerModal();

    setTimeout(() => {
        document.getElementById('lawyer-name').value = name;
        document.getElementById('lawyer-bar').value = bar;
        document.getElementById('lawyer-bar-number').value = barNumber;
        document.getElementById('lawyer-phone').value = phone;
        document.getElementById('lawyer-address').value = address;
        
        // Modal başlığını güncelle
        const titleSection = document.querySelector('#lawyerModal .modal-title-section h3');
        if (titleSection) {
            titleSection.textContent = 'Vekil Düzenle';
        }
        
        // Ekle butonunu güncelle butonuna çevir
        const addBtn = document.querySelector('#lawyerModal .btn-primary');
        if (addBtn) {
            addBtn.innerHTML = '<i class="material-icons">save</i> Güncelle';
            addBtn.onclick = updateLawyer;
        }
    }, 100);
}

function updateLawyer() {
    const name = document.getElementById('lawyer-name').value.trim();
    const bar = document.getElementById('lawyer-bar').value.trim();
    const barNumber = document.getElementById('lawyer-bar-number').value.trim();
    const phone = document.getElementById('lawyer-phone').value.trim();
    const address = document.getElementById('lawyer-address').value.trim();

    if (!name || !barNumber) {
        alert('Vekil adı ve baro numarası zorunludur!');
        return;
    }

    // Vekil bilgilerini güncelle
    document.getElementById('opponent-lawyer').value = name;
    document.getElementById('opponent-lawyer-bar-number').value = barNumber;
    document.getElementById('opponent-lawyer-phone').value = phone;
    document.getElementById('opponent-lawyer-address').value = address;

    // Baro bilgisini güncelle
    let barInput = document.querySelector('input[name="opponent-lawyer-bar"]');
    if (barInput) {
        barInput.value = bar;
    } else {
        addHiddenInput('opponent-lawyer-bar', bar);
    }

    // Kartı yeniden oluştur
    const lawyerContainer = document.getElementById('lawyer-display');
    if (lawyerContainer) {
        const lawyerCard = createLawyerCard(name, bar, barNumber, phone, address);
        lawyerContainer.innerHTML = '';
        lawyerContainer.appendChild(lawyerCard);
    }
    
    closeLawyerModal();
    showSuccessMessage('Vekil bilgileri güncellendi!');
}

function removeLawyer() {
    if (confirm('Vekil bilgilerini silmek istediğinizden emin misiniz?')) {
        // Vekil bilgilerini temizle
        document.getElementById('opponent-lawyer').value = '';
        document.getElementById('opponent-lawyer-bar-number').value = '';
        document.getElementById('opponent-lawyer-phone').value = '';
        document.getElementById('opponent-lawyer-address').value = '';

        // Baro hidden input'ını da temizle
        const barInput = document.querySelector('input[name="opponent-lawyer-bar"]');
        if (barInput) {
            barInput.remove();
        }
        
        // Vekil kartını gizle
        const lawyerContainer = document.getElementById('lawyer-display');
        if (lawyerContainer) {
            lawyerContainer.style.display = 'none';
            lawyerContainer.innerHTML = '';
        }
        
        // Vekil ekleme butonunu göster
        const addBtn = document.querySelector('[onclick="showLawyerModal()"]');
        if (addBtn) {
            addBtn.style.display = 'block';
        }
        
        showSuccessMessage('Vekil bilgileri silindi!');
    }
}
</script>

{% endblock %}